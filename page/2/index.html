<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.2.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.1/css/all.min.css">
  <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css">

<script class="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhangfengqilk.github.io","root":"/","scheme":"Mist","version":"8.0.2","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="PALM BEACH">
<meta property="og:url" content="https://zhangfengqilk.github.io/page/2/index.html">
<meta property="og:site_name" content="PALM BEACH">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://zhangfengqilk.github.io/page/2/">


<script class="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'en'
  };
</script>

  <title>PALM BEACH</title>
  






  <noscript>
  <style>
  body { margin-top: 2rem; }

  .use-motion .menu-item,
  .use-motion .sidebar,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header {
    visibility: visible;
  }

  .use-motion .header,
  .use-motion .site-brand-container .toggle,
  .use-motion .footer { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle,
  .use-motion .custom-logo-image {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line {
    transform: scaleX(1);
  }

  .search-pop-overlay, .sidebar-nav { display: none; }
  .sidebar-panel { display: block; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">PALM BEACH</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <section class="post-toc-wrap sidebar-panel">
        </section>
        <!--/noindex-->

        <section class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">21</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



        </section>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">
      

      
    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/springboot%E4%B8%AD%E7%9A%84@DeleteMapping%E6%B3%A8%E8%A7%A3%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E5%80%BC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/springboot%E4%B8%AD%E7%9A%84@DeleteMapping%E6%B3%A8%E8%A7%A3%E6%97%A0%E6%B3%95%E8%8E%B7%E5%8F%96%E5%8F%82%E6%95%B0%E5%80%BC/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-08-17 17:04:37" itemprop="dateModified" datetime="2020-08-17T17:04:37+08:00">2020-08-17</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="springboot中的-DeleteMapping注解无法获取参数值"><a href="#springboot中的-DeleteMapping注解无法获取参数值" class="headerlink" title="springboot中的@DeleteMapping注解无法获取参数值"></a><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000011211490">springboot中的@DeleteMapping注解无法获取参数值</a></h1><p><a target="_blank" rel="noopener" href="https://segmentfault.com/t/springboot">springboot</a></p>
<blockquote>
<p>最近在试试使用springboot编写一个demo进行测试，测试过程中发现@DeleteMapping注解有一些问题，现在汇总如下，有大神指点一下</p>
</blockquote>
<p>示例1：<br>问题：无法获取参数id的值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@DeleteMapping(value &#x3D; &quot;userinfo&quot;)</span><br><span class="line">public void deleteUserinfo(Integer id) &#123;</span><br><span class="line">    System.out.println(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; id : &quot; + id);</span><br><span class="line">    this.dao.delete(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在spring-mvc中，经常使用上面的方法获取参数，无论是get还是post方法都可以获取的到，但是在springboot中这种写法得到的id却是null，然后方法就抛出异常，因为delete方法的参数值不能为null；</p>
<p>为什么这种方式获取不到参数值呢？</p>
<p>示例2：<br>问题：无法执行方法，无法获取参数值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@DeleteMapping(value &#x3D; &quot;userinfo3&quot;)</span><br><span class="line">public void deleteUserinfo3(@RequestParam(&quot;id&quot;) int id) &#123;</span><br><span class="line">    System.out.println(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; id : &quot; + id);</span><br><span class="line">    this.dao.delete(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在postman中进行的测试，无论是 form-data还是x-www-form-unlencoded类型，都无法进入方法体，连第一句打印都不执行，直接报<strong>400</strong>的错误，错误信息如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;timestamp&quot;: 1505653583069,</span><br><span class="line">  &quot;status&quot;: 400,</span><br><span class="line">  &quot;error&quot;: &quot;Bad Request&quot;,</span><br><span class="line">  &quot;exception&quot;: &quot;org.springframework.web.bind.MissingServletRequestParameterException&quot;,</span><br><span class="line">  &quot;message&quot;: &quot;Required int parameter &#39;id&#39; is not present&quot;,</span><br><span class="line">  &quot;path&quot;: &quot;&#x2F;userinfo&#x2F;userinfo3&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>很不理解，put方法可以通过修改x-www-form-unlencoded方式，然后通过@RequestParam方法获取参数值，但是delee却不行，不知为何</p>
<p>示例3：<br>问题：获取不到参数值</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@DeleteMapping(value &#x3D; &quot;userinfo4&quot;)</span><br><span class="line">public void deleteUserinfo4(Userinfo userinfo) &#123;</span><br><span class="line">    System.out.println(userinfo);</span><br><span class="line">    this.dao.delete(userinfo);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在post方法中可以使用entity来接受参数，但是delete方法却不行；<br>上面方法虽然可以执行到方法里面，第一行打印也有内容，但是userinfo对象是空的，没有获取到任何参数，不知为何！<br>后台日志如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;age&quot;:0,&quot;id&quot;:0&#125;</span><br><span class="line">Hibernate: insert into userinfo (age, cup_size, name) values (?, ?, ?)</span><br><span class="line">Hibernate: delete from userinfo where id&#x3D;?</span><br></pre></td></tr></table></figure>

<blockquote>
<p>极其匪夷所思，我只是执行了一个delete操作，为什么日志会打印insert into 语句呢？</p>
</blockquote>
<p>示例4：<br>问题 : 无法获取参数值，方法直接进不到方法体中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@DeleteMapping(value &#x3D; &quot;userinfoMap&quot;)</span><br><span class="line">public void deleteUserinfoMap(@RequestBody Map&lt;String, String&gt; map) &#123;</span><br><span class="line">    System.out.println(map);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>示例5：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@DeleteMapping(value &#x3D; &quot;userinfo&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">public void deleteUserinfo2(@PathVariable(&quot;id&quot;) int id) &#123;</span><br><span class="line">    System.out.println(&quot;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D; id : &quot; + id);</span><br><span class="line">    this.dao.delete(id);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>上面的5个例子，只有这种情况下，通过restful的方法才能获取deletemapping的参数值，实在是费解。</p>
<p>另外的一个问题 :<br>在示例5中，delete操作竟然不能执行2次，当第二次执行的时候，由于数据已经被删除，导致程序直接抛出异常，错误信息如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;timestamp&quot;: 1505654465700,</span><br><span class="line">  &quot;status&quot;: 500,</span><br><span class="line">  &quot;error&quot;: &quot;Internal Server Error&quot;,</span><br><span class="line">  &quot;exception&quot;: &quot;org.springframework.dao.EmptyResultDataAccessException&quot;,</span><br><span class="line">  &quot;message&quot;: &quot;No class com.zzg.springboot.firstbootweb.entity.Userinfo entity with id 2 exists!&quot;,</span><br><span class="line">  &quot;path&quot;: &quot;&#x2F;userinfo&#x2F;userinfo&#x2F;2&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>阅读 19.1k</p>
<p> 赞 1踩</p>
<p> 收藏 2关注 7</p>
<p><a href="javascript:;">评论</a> 更新于 2017-09-17</p>
<p><img src="https://sponsor.segmentfault.com/lg.php?bannerid=51&campaignid=1&zoneid=3&loc=https://segmentfault.com/q/1010000011211490&referer=https://www.baidu.com/link?url=j2Hmj-IKB94pj4xQf4qek9WfD8LmebDZ-iM03Q6un4nvVk3226a9Y7LtPHGY1MWo5auuRVoShc6OZXqkWDdYOK&wd=&eqid=ac37a5dd00022b64000000025f3a45e5&cb=240a219840" alt="img"></p>
<p>5 个回答</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000011211490#comment-area">得票</a><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000011211490?sort=created#comment-area">时间</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/u/krun"><img src="https://avatar-static.segmentfault.com/380/923/3809239748-59bfa75261934_big64" alt="avatar"><strong>krun</strong></a></p>
<ul>
<li> <strong>6.6k</strong></li>
</ul>
<p>情况5中的 <code>@PathVariable</code> 注解是从请求路径中获取值，与 <code>RequestBody</code> 无关，所以能取到。</p>
<p><code>@DeleteMapping</code> 注解的参数其实有办法取到，方法的参数加个 <code>@RequestBody</code> 注解，这样就是直接获取整个原始请求体，就要你自己解析了。<br>postman的话，body类型设置为raw即可：</p>
<p><img src="https://segmentfault.com/img/bVVcYr?w=492&h=627" alt="clipboard.png"></p>
<p><img src="https://segmentfault.com/img/bVVcZk?w=349&h=170" alt="clipboard.png"></p>
<p>搜索了一下网上的资料<br><a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000011211490#http://blog.csdn.net/qq_37545366/article/details/76132040">这是一种做法</a>，但是我不清楚这适不适合你。</p>
<p>记得很久以前看到过关于这个问题的说明，好像是说 Spring 的 <code>@RequestMapping</code> 对 <code>GET/POST</code> 以外的请求方式没有做完整的解析，当时那篇文章说要自己手动实现，现在找不到那篇文章了，也可能是我记忆有误。</p>
<p>然后关于你 情况5 的 “二次删除数据报错”<br>你的确是已经删除了id为2的数据啊，怎么可能再删除得了呢？<br>你可以把delete操作catch起来，检查是否为这个已知异常，是的话传回错误信息 “id 不存在”</p>
<p> 赞 2</p>
<p> 已采纳</p>
<p><a href="javascript:;">评论</a> <a href="javascript:;">赞赏</a> <a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000011211490/a-1020000011212299">更新于 2017-09-17</a></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/u/dayanda"><strong>上邪</strong></a>： </p>
<p>谢谢你，把这么长一个问题全看完了！！<br>@RequestBody 应该能获取的到，我上面有一个示例说这种获取不到，是因为我突然想起来，当时没有使用raw的方式传递json数据！</p>
<p><a href="javascript:;"> </a> <a href="javascript:;">回复</a> 2017-09-18</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/u/krun"><strong>krun</strong></a>： </p>
<p>哈哈 只是要自己解析了 不过应该也不算太复杂</p>
<p><a href="javascript:;"> </a> <a href="javascript:;">回复</a> 2017-09-18</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/u/akemengde"><img src="https://cdn.segmentfault.com/v-5f0a9217/global/img/user-64.png" alt="avatar"><strong>阿克蒙德</strong></a></p>
<ul>
<li> <strong>2</strong></li>
<li><strong>新人请关照</strong></li>
</ul>
<p>不知道楼主有没有解决<br>用 x-www-form-uilencodeded 是可以的</p>
<p> 赞</p>
<p><a href="javascript:;">评论</a> <a href="javascript:;">赞赏</a> <a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000011211490/a-1020000015032134">更新于 2018-05-25</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/u/shitoujianzibeier"><img src="https://cdn.segmentfault.com/v-5f0a9217/global/img/user-64.png" alt="avatar"><strong>石头剪子贝儿</strong></a></p>
<ul>
<li> <strong>3</strong></li>
<li><strong>新人请关照</strong></li>
</ul>
<p>使用@requestBody注解后,并没有解决该问题</p>
<p> 赞</p>
<p><a href="javascript:;">评论</a> <a href="javascript:;">赞赏</a> <a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000011211490/a-1020000017980010">更新于 2019-01-22</a></p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/u/main_5c8ef1d2b6ba4"><img src="https://avatar-static.segmentfault.com/172/216/1722162001-5c8ef2faac5ee_big64" alt="avatar"><strong>main</strong></a></p>
<ul>
<li> <strong>1</strong></li>
<li><strong>新人请关照</strong></li>
</ul>
<p>楼主解决了吗，我传的是一个UserList的一个id串，PostMan我用x-www-form-uilencodeded传的，后端用的@deleteMapping然后接收不到参数</p>
<p> 赞</p>
<p><a href="javascript:;">评论</a> <a href="javascript:;">赞赏</a> <a target="_blank" rel="noopener" href="https://segmentfault.com/q/1010000011211490/a-1020000018550400">发布于 2019-03-18</a></p>
<ul>
<li><p><a target="_blank" rel="noopener" href="https://segmentfault.com/u/dayanda"><strong>上邪</strong></a>： </p>
<p>最后没有再跟进这个问题，因为当时也是做测试写的demo</p>
<p><a href="javascript:;"> </a> <a href="javascript:;">回复</a> 2019-03-18</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/u/chilion"><img src="https://cdn.segmentfault.com/v-5f0a9217/global/img/user-64.png" alt="avatar"><strong>chilion</strong></a></p>
<ul>
<li> <strong>1</strong></li>
<li><strong>新人请关照</strong></li>
</ul>
<p>很好，这个坑今天被我踩到了，接收到的参数变成null 是因为<br>这个value属性，把它干掉就可以接收到数据了。具体什么原因我还没来得及看，我也是对比了好久才试出来的 <img src="https://segmentfault.com/img/bVbs5dT?w=405&h=36" alt="clipboard.png"></p>
<p><img src="https://segmentfault.com/img/bVbs5ef?w=320&h=19" alt="clipboard.png"></p>
<p><img src="https://segmentfault.com/img/bVbs5em?w=189&h=24" alt="clipboard.png"></p>
<p>- </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/windows%20%E9%80%9A%E8%BF%87%E6%9C%89%E7%BA%BF%E5%85%B1%E4%BA%AB%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/windows%20%E9%80%9A%E8%BF%87%E6%9C%89%E7%BA%BF%E5%85%B1%E4%BA%AB%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-06-23 06:19:52" itemprop="dateModified" datetime="2020-06-23T06:19:52+08:00">2020-06-23</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="windows-通过有线共享网络"><a href="#windows-通过有线共享网络" class="headerlink" title="windows 通过有线共享网络"></a>windows 通过有线共享网络</h1><h5 id="问题：-目前有两台电脑，还有一个无线WIFI热点，一个电脑有无线网卡，另一个没有，如何使两个电脑同时上网？"><a href="#问题：-目前有两台电脑，还有一个无线WIFI热点，一个电脑有无线网卡，另一个没有，如何使两个电脑同时上网？" class="headerlink" title="问题： 目前有两台电脑，还有一个无线WIFI热点，一个电脑有无线网卡，另一个没有，如何使两个电脑同时上网？"></a>问题： 目前有两台电脑，还有一个无线WIFI热点，一个电脑有无线网卡，另一个没有，如何使两个电脑同时上网？</h5><p>解决方案：</p>
<ul>
<li>电脑A同时具备无线网卡和有线网卡，电脑B只有有线网卡，右键电脑A的无线网卡属性，找到共享选项卡，勾选允许通过此计算机的Internet连接</li>
<li>这时候查看有线网卡，IP4中自动设置了IP地址为192.168.137.1，首选DNS设置为无线网卡的IP地址</li>
<li>电脑B的IP地址设置为自动获取，这时候就完成了两个电脑同时上网</li>
</ul>
<p><img src="https://s1.ax1x.com/2020/06/23/NNMXUf.png" alt="NNMXUf.png"></p>
<p><img src="https://s1.ax1x.com/2020/06/23/NNQpvj.png" alt="NNQpvj.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/%E6%8A%8AObject%E7%B1%BB%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%AE%9E%E4%BD%93%E7%B1%BB/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/%E6%8A%8AObject%E7%B1%BB%E8%BD%AC%E6%8D%A2%E4%B8%BA%E5%AE%9E%E4%BD%93%E7%B1%BB/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-07-31 15:47:59" itemprop="dateModified" datetime="2020-07-31T15:47:59+08:00">2020-07-31</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="把Object类转换为实体类"><a href="#把Object类转换为实体类" class="headerlink" title="把Object类转换为实体类"></a>把Object类转换为实体类</h1><h3 id="问题描述"><a href="#问题描述" class="headerlink" title="问题描述"></a>问题描述</h3><p>在用SpringBoot写controller的时候，需要接受一个map的Object，之后要把Object转为特定的类，代码如下：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">postArticle</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        ArticleInfo articleInfo = (ArticleInfo) map.get(<span class="string">&quot;articleInfo&quot;</span>);</span><br><span class="line">        ArticleContent articleContent = (ArticleContent) map.get(<span class="string">&quot;articleContent&quot;</span>);</span><br><span class="line">        System.out.println(articleInfo + <span class="string">&quot; &quot;</span> + articleContent);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="number">123456</span></span><br></pre></td></tr></table></figure>

<p>之后爆出异常：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">java.lang.ClassCastException: <span class="class"><span class="keyword">class</span> <span class="title">java</span>.<span class="title">util</span>.<span class="title">LinkedHashMap</span> <span class="title">cannot</span> <span class="title">be</span> <span class="title">cast</span> <span class="title">to</span> <span class="title">class</span> </span></span><br><span class="line"><span class="class"><span class="title">cn</span>.<span class="title">zi10ng</span>.<span class="title">blog</span>.<span class="title">domain</span>.<span class="title">ArticleInfo</span> (<span class="title">java</span>.<span class="title">util</span>.<span class="title">LinkedHashMap</span> <span class="title">is</span> <span class="title">in</span> <span class="title">module</span> <span class="title">java</span>.<span class="title">base</span> <span class="title">of</span> <span class="title">loader</span></span></span><br><span class="line"><span class="class"> &#x27;<span class="title">bootstrap</span>&#x27;</span>; cn.zi10ng.blog.domain.ArticleInfo is in unnamed <span class="keyword">module</span> of loader </span><br><span class="line"> org.springframework.boot.devtools.restart.classloader.RestartClassLoader @19b54dc3)</span><br><span class="line"><span class="number">1234</span></span><br></pre></td></tr></table></figure>

<h3 id="问题原因"><a href="#问题原因" class="headerlink" title="问题原因"></a>问题原因</h3><p>map中取出的是Object，不能直接把Object转为特定的实体类</p>
<h3 id="解决办法有两个："><a href="#解决办法有两个：" class="headerlink" title="解决办法有两个："></a>解决办法有两个：</h3><ul>
<li><strong><em>需要通过json来作为中间介质</em></strong>：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">postArticle</span><span class="params">(<span class="meta">@RequestBody</span> Map&lt;String, Object&gt; map)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String jsonInfo = objectMapper.writeValueAsString(map.get(<span class="string">&quot;articleInfo&quot;</span>));</span><br><span class="line">        String jsonContent = objectMapper.writeValueAsString(map.get(<span class="string">&quot;articleContent&quot;</span>));</span><br><span class="line">        ArticleInfo articleInfo = objectMapper.readValue(jsonInfo,ArticleInfo.class);</span><br><span class="line">        ArticleContent articleContent = objectMapper.readValue(jsonContent,ArticleContent.class);</span><br><span class="line"></span><br><span class="line">        System.out.println(articleContent + <span class="string">&quot; &quot;</span> +articleInfo);</span><br><span class="line">        <span class="keyword">return</span> articleService.insertArticle(articleInfo,articleContent);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="number">1234567891011</span></span><br></pre></td></tr></table></figure>

<ul>
<li><strong><em>通过com.fastxml.jackson的ObjectMapper对象进行转换：</em></strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">objectMapper.convertValue(Object fromValue, Class&lt;T&gt; toValueType);</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/%E7%AC%A6%E5%90%88%E8%A7%84%E8%8C%83%E7%9A%84url/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/%E7%AC%A6%E5%90%88%E8%A7%84%E8%8C%83%E7%9A%84url/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-09-10 16:21:44" itemprop="dateModified" datetime="2020-09-10T16:21:44+08:00">2020-09-10</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="符合规范的url"><a href="#符合规范的url" class="headerlink" title="符合规范的url"></a>符合规范的url</h1><h1 id="描述"><a href="#描述" class="headerlink" title="描述"></a>描述</h1><p>进公司没有多久遇到一个问题，定义的url会被大神吐槽说是很渣。之前从来没有注意这块，今天把我们团队的url规范分享给大家。</p>
<h1 id="为什么需要URL规范化"><a href="#为什么需要URL规范化" class="headerlink" title="为什么需要URL规范化"></a>为什么需要URL规范化</h1><p>1、网站URL和结构已经成为网站搜索引擎友好的最大基础性问题，网站URL 和结构问题，早发现早优化，越是往后放，最后就成了制约网站运营和产品开发的决定性因素。<br>2、无论是网站的可用性还是网站对搜索引擎的吸引力，清晰明了的浏览路径都是相当重要的，URL是统一资源定位，即每个网页的网址、路径。<br>3、浏览路径让网站的导航结构更清晰，可以更加平衡的分布网站权重。</p>
<h1 id="反例（不规范的URL）"><a href="#反例（不规范的URL）" class="headerlink" title="反例（不规范的URL）"></a>反例（不规范的URL）</h1><h3 id="URL中多余的字符"><a href="#URL中多余的字符" class="headerlink" title="URL中多余的字符"></a>URL中多余的字符</h3><p>1、子域名的URL中包含”www”: “<a target="_blank" rel="noopener" href="http://www.shuchao.cnblogs.com/&quot;">http://www.shuchao.cnblogs.com/&quot;</a></p>
<p>2、含有默认端口: “<a target="_blank" rel="noopener" href="http://www.cnblogs.com/shuchao/">http://www.cnblogs.com:80/shuchao/</a>“</p>
<p>3、松散的URL: “<a target="_blank" rel="noopener" href="http://www.chapters.indigo.ca/books/amazon-sucks-donkey-balls/9780470170779-item.html&quot;">http://www.chapters.indigo.ca/books/amazon-sucks-donkey-balls/9780470170779-item.html&quot;</a></p>
<p>4、多余默认文件名index.html,default.aspx等：”<a target="_blank" rel="noopener" href="http://www.cnblogs.com/shuchao/index.html&quot;">http://www.cnblogs.com/shuchao/index.html&quot;</a></p>
<p>5、文件路径中包含多余的”/“:”<a target="_blank" rel="noopener" href="http://www.cnblogs.com/shuchao//&quot;%EF%BC%8C%E5%A4%9A%E4%BD%99%E7%9A%84%E7%82%B9%E4%BF%AE%E9%A5%B0%E4%B8%B2:&quot;x/y/z/http://www.cnblogs.com/a/b/http://page.html&quot;">http://www.cnblogs.com/shuchao//&quot;，多余的点修饰串:&quot;x/y/z/http://www.cnblogs.com/a/b/http://www.cnblogs.com/../page.html&quot;</a></p>
<p>6、查询串中多余的 ? (空查询串):<a target="_blank" rel="noopener" href="http://www.cnblogs.com/shuchao">http://www.cnblogs.com/shuchao</a>?</p>
<p>7、多余的&amp; 无用的查询变量:<a target="_blank" rel="noopener" href="http://www.example.com/display?id=123&amp;fake=fake">http://www.example.com/display?id=123&amp;fake=fake</a></p>
<h3 id="URL缺少字符串"><a href="#URL缺少字符串" class="headerlink" title="URL缺少字符串"></a>URL缺少字符串</h3><p>缺少”/“:”<a target="_blank" rel="noopener" href="http://www.cnblogs.com/shuchao&quot;">http://www.cnblogs.com/shuchao&quot;</a><br>查询串缺少名称或者值:”<a target="_blank" rel="noopener" href="http://www.example.com/display?id=&quot;">http://www.example.com/display?id=&quot;</a> 或者 “<a target="_blank" rel="noopener" href="http://www.example.com/display?=123&quot;">http://www.example.com/display?=123&quot;</a></p>
<h3 id="其他不规范的URL"><a href="#其他不规范的URL" class="headerlink" title="其他不规范的URL"></a>其他不规范的URL</h3><p>1、”<a target="_blank" rel="noopener" href="http://shuchao.cnblogs.com/&quot;">http://shuchao.cnblogs.com/&quot;</a> 与 “<a target="_blank" rel="noopener" href="http://www.cnblogs.com/shuchao/&quot;%E5%85%B6%E5%AE%9E%E6%98%AF%E7%9B%B8%E5%90%8C%E7%9A%84%E5%86%85%E5%AE%B9%E5%8D%B3%E5%90%8C%E4%B8%80%E4%B8%AA%E8%B5%84%E6%BA%90%EF%BC%8C%E6%9C%80%E5%A5%BD%E4%B8%8D%E8%A6%81%E6%9C%89%E4%B8%A4%E4%B8%AAurL">http://www.cnblogs.com/shuchao/&quot;其实是相同的内容即同一个资源，最好不要有两个urL</a></p>
<p>2、使用IP代替域名</p>
<p>3、大小写敏感(“<a target="_blank" rel="noopener" href="http://www.google.cn/Intl/zh-CN/about.html&quot;">http://www.google.cn/Intl/zh-CN/about.html&quot;</a> 和”<a target="_blank" rel="noopener" href="http://www.google.cn/intl/zh-CN/about.html&quot;">http://www.google.cn/intl/zh-CN/about.html&quot;</a>)</p>
<p>4、查询变量顺序混乱:”<a target="_blank" rel="noopener" href="http://www.example.com/test.aspx?bar=1&amp;a=test&quot;">http://www.example.com/test.aspx?bar=1&amp;a=test&quot;</a></p>
<p>5、含临时的状态变量:<a target="_blank" rel="noopener" href="http://www.example.com/test?back=/prevpage.aspx">http://www.example.com/test?back=/prevpage.aspx</a></p>
<h1 id="设计URL应该遵循的原则"><a href="#设计URL应该遵循的原则" class="headerlink" title="设计URL应该遵循的原则"></a>设计URL应该遵循的原则</h1><h3 id="一、简单，好记"><a href="#一、简单，好记" class="headerlink" title="一、简单，好记"></a>一、简单，好记</h3><p>简单好记的域名会给人以深刻的印象。</p>
<h3 id="二、URL中的字母全部用小写"><a href="#二、URL中的字母全部用小写" class="headerlink" title="二、URL中的字母全部用小写"></a>二、URL中的字母全部用小写</h3><p>全部用小写，用户比较容易输入，不用因为大小写混合而出现错误，这是人们的输入习惯<br>有些服务器是区分大小写的，例如Lunix服务器，这样在站长做链接或者是用户输入时，会因为大小写的问题而出现404错误，<br>而且robots也是区分大小写的，如果大小写搞错了，可能会造成不能收录的严重问题。所以建议所有的URL都使用小写</p>
<h3 id="三、连词符的使用"><a href="#三、连词符的使用" class="headerlink" title="三、连词符的使用"></a>三、连词符的使用</h3><p>目录或者文件名中如果有两个单词组成时，一般建议中间使用中划线(-)隔开，<br>切记不要使用下划线或者其他字符，在搜索引擎中，它是把中划线当作一个空格来处理的，而下划线则是被忽略的，<br>例如seo-caipiao会被读成seo与caipiao。这是比较友好的写法</p>
<h3 id="四、URL中避免太多参数"><a href="#四、URL中避免太多参数" class="headerlink" title="四、URL中避免太多参数"></a>四、URL中避免太多参数</h3><p>设计的则是URL中的参数应该尽量减少，不要超过三个，一般的情况下URL中的参数2-3个就可以了。</p>
<h3 id="五、目录层次尽量少"><a href="#五、目录层次尽量少" class="headerlink" title="五、目录层次尽量少"></a>五、目录层次尽量少</h3><p>这里所指的目录层次是指物理目录结构，而不是指逻辑结构，我们在进行URL的设计时，<br>网站的结构要尽量的去减少目录层次，层次不能太深了，一般建议不要超过三层，特别对于一些新站来说，<br>权重低，搜索引擎蜘蛛爬行得很浅，深一点的页面，蜘蛛都很可能不会去爬行的，所以要尽量的做到使目录层次减少，<br>URL缩短。根据观察，百度尤其比较喜欢目录层次比较少的页面。</p>
<h3 id="六、文件名及目录名要具描述性"><a href="#六、文件名及目录名要具描述性" class="headerlink" title="六、文件名及目录名要具描述性"></a>六、文件名及目录名要具描述性</h3><p>文件名及目录名要具有可描述性，不但让用户一眼就能看出来这个页面是关于什么的，<br>对用户体验比较友好，而且搜索引擎也比较喜欢这样的URL。<br>例如一个关于新闻的目录，我们可以把它命名为news，用户看到这个目录名称，大概就知道这个目录是关于什么内容的了。</p>
<h3 id="七、URL应该呈现一个降级的次序"><a href="#七、URL应该呈现一个降级的次序" class="headerlink" title="七、URL应该呈现一个降级的次序"></a>七、URL应该呈现一个降级的次序</h3><p>例如：域名/类型/分类/标题<br>例如：域名/年/月/日<br><a target="_blank" rel="noopener" href="http://domain.com/news/tech/2007/11/05/google-announces-android">http://domain.com/news/tech/2007/11/05/google-announces-android</a></p>
<h3 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h3><p>1.URL能反应站点的结构<br>2.URL是可以被用户猜测和hack的（也鼓励用户如此）<br>3.永久链接，Cool URLdon’t change<br>4.动态的也要做成伪静态</p>
<h1 id="url规范诞生"><a href="#url规范诞生" class="headerlink" title="url规范诞生"></a>url规范诞生</h1><h3 id="一、基本规范"><a href="#一、基本规范" class="headerlink" title="一、基本规范"></a>一、基本规范</h3><p>1、不能使用中文单词，最好使用有意义的英文单词，少用拼音。</p>
<p>2、层级不能超过三级。<br>例如：<a target="_blank" rel="noopener" href="http://domain.com/xx/xx/xx/xx.html%E4%B8%8D%E8%A2%AB%E5%85%81%E8%AE%B8%E3%80%82">http://domain.com/xx/xx/xx/xx.html不被允许。</a></p>
<p>3、URL的参数不允许超过3个</p>
<p>4、URL全部小写</p>
<p>5、网站内部在链接到其他网页，尤其是主页时，只使用一种URL，即不允许同一个资源有多个URL。</p>
<p>6、不允许出现没有意义的下URL<br>例如：<a target="_blank" rel="noopener" href="http://www.uxuexi.cn/123.html%E3%80%82%E8%B0%81%E4%B9%9F%E7%9C%8B%E4%B8%8D%E6%98%8E%E7%99%BD%E6%98%AF%E4%BB%80%E4%B9%88%E6%84%8F%E6%80%9D%E3%80%82">http://www.uxuexi.cn/123.html。谁也看不明白是什么意思。</a></p>
<p>7、如果是内容资源URL，不允许以参数的方法显示<br>例如：<a target="_blank" rel="noopener" href="http://www.uxuexi.cn/user.html?userId=123">http://www.uxuexi.cn/user.html?userId=123</a> 需要改成<a target="_blank" rel="noopener" href="http://www.uxuexi.cn/user/123.html">http://www.uxuexi.cn/user/123.html</a></p>
<h3 id="二、URL类型设置"><a href="#二、URL类型设置" class="headerlink" title="二、URL类型设置"></a>二、URL类型设置</h3><p>1、目录<br>一般用在频道页或是文章栏目（这种方式能获得更多的权重），最后面必须加上“/”<br>例如：<a target="_blank" rel="noopener" href="http://www.uxuexi.cn/search%E9%9C%80%E8%A6%81%E6%94%B9%E6%88%90http://www.uxuexi.cn/search/">http://www.uxuexi.cn/search需要改成http://www.uxuexi.cn/search/</a></p>
<p>2、网页<br>一般用来表现网页内容，需要直接显示在页面的必须以.html结尾<br>例如:<a target="_blank" rel="noopener" href="http://www.uxuexi.cn/123">http://www.uxuexi.cn/123</a> 需要改成<a target="_blank" rel="noopener" href="http://www.uxuexi.cn/user/123.html">http://www.uxuexi.cn/user/123.html</a></p>
<p>3.特定功能或交互式<br>统一以.json 或者.html结尾<br>例如：<br>添加评论 <a target="_blank" rel="noopener" href="http://www.uxuexi.cn/addcomment.json">http://www.uxuexi.cn/addcomment.json</a></p>
<h3 id="三、静态化"><a href="#三、静态化" class="headerlink" title="三、静态化"></a>三、静态化</h3><p>1、不经常更新的内容采用静态化。例如：<a target="_blank" rel="noopener" href="http://course.uxuexi.cn/detail/111.html%E3%80%82URL%E4%B8%AD%E4%B8%8D%E5%85%81%E8%AE%B8%E4%BD%BF%E7%94%A8?%E5%B8%A6%E5%8F%82%E6%95%B0%E3%80%82">http://course.uxuexi.cn/detail/111.html。URL中不允许使用?带参数。</a><br>2、实时更新的内容采用伪静态。例如：<a target="_blank" rel="noopener" href="http://www.uxuexi.cn/user/111.html%E3%80%82URL%E4%B8%AD%E4%B8%8D%E5%85%81%E8%AE%B8%E4%BD%BF%E7%94%A8?%E5%B8%A6%E5%8F%82%E6%95%B0%E3%80%82">http://www.uxuexi.cn/user/111.html。URL中不允许使用?带参数。</a><br>特定功能或交互式用动态URL。</p>
<h1 id="约定"><a href="#约定" class="headerlink" title="约定"></a>约定</h1><p>所有需要跳转页面的url必须进行统一的管理，统一使用cms:url自定义标签来实现，方便维护和优化。<br>例如<br>每次添加url，必须写上注释。<br>注释url功能，注释每一个参数是什么意思</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/BlockingQueue%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/BlockingQueue%E5%8F%8A%E5%85%B6%E5%AE%9E%E7%8E%B0/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-07-03 09:20:46" itemprop="dateModified" datetime="2020-07-03T09:20:46+08:00">2020-07-03</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="1-前言"><a href="#1-前言" class="headerlink" title="1. 前言"></a>1. 前言</h1><p>BlockingQueue即阻塞队列，它是基于ReentrantLock，依据它的基本原理，我们可以实现Web中的长连接聊天功能，当然其最常用的还是用于实现生产者与消费者模式，大致如下图所示：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4180398-89f0d2693361656e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/873/format/webp" alt="img"></p>
<blockquote>
<p>在Java中，BlockingQueue是一个接口，它的实现类有ArrayBlockingQueue、DelayQueue、 LinkedBlockingDeque、LinkedBlockingQueue、PriorityBlockingQueue、SynchronousQueue等，它们的区别主要体现在存储结构上或对元素操作上的不同，但是对于take与put操作的原理，却是类似的。</p>
</blockquote>
<h1 id="2-阻塞与非阻塞"><a href="#2-阻塞与非阻塞" class="headerlink" title="2. 阻塞与非阻塞"></a>2. 阻塞与非阻塞</h1><h2 id="入队"><a href="#入队" class="headerlink" title="入队"></a><strong>入队</strong></h2><blockquote>
<p>offer(E e)：如果队列没满，立即返回true； 如果队列满了，立即返回false–&gt;不阻塞</p>
<p>put(E e)：如果队列满了，一直阻塞，直到队列不满了或者线程被中断–&gt;阻塞</p>
<p>offer(E e, long timeout, TimeUnit unit)：在队尾插入一个元素,，如果队列已满，则进入等待，直到出现以下三种情况：–&gt;阻塞</p>
<p>被唤醒</p>
<p>等待时间超时</p>
<p>当前线程被中断</p>
</blockquote>
<h2 id="出队"><a href="#出队" class="headerlink" title="出队"></a><strong>出队</strong></h2><blockquote>
<p>poll()：如果没有元素，直接返回null；如果有元素，出队</p>
<p>take()：如果队列空了，一直阻塞，直到队列不为空或者线程被中断–&gt;阻塞</p>
<p>poll(long timeout, TimeUnit unit)：如果队列不空，出队；如果队列已空且已经超时，返回null；如果队列已空且时间未超时，则进入等待，直到出现以下三种情况：</p>
<p>被唤醒</p>
<p>等待时间超时</p>
<p>当前线程被中断</p>
</blockquote>
<h1 id="3-LinkedBlockingQueue-源码分析"><a href="#3-LinkedBlockingQueue-源码分析" class="headerlink" title="3. LinkedBlockingQueue 源码分析"></a>3. LinkedBlockingQueue 源码分析</h1><p>LinkedBlockingQueue是一个基于链表实现的可选容量的阻塞队列。队头的元素是插入时间最长的，队尾的元素是最新插入的。新的元素将会被插入到队列的尾部。 </p>
<p>LinkedBlockingQueue的容量限制是可选的，如果在初始化时没有指定容量，那么默认使用int的最大值作为队列容量。</p>
<h2 id="底层数据结构"><a href="#底层数据结构" class="headerlink" title="底层数据结构"></a><strong>底层数据结构</strong></h2><p>LinkedBlockingQueue内部是使用链表实现一个队列的，但是却有别于一般的队列，在于该队列至少有一个节点，头节点不含有元素。结构图如下：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4180398-d987601194c3e199.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/835/format/webp" alt="img"></p>
<h2 id="原理"><a href="#原理" class="headerlink" title="原理"></a><strong>原理</strong></h2><p>LinkedBlockingQueue中维持两把锁，一把锁用于入队，一把锁用于出队，这也就意味着，同一时刻，只能有一个线程执行入队，其余执行入队的线程将会被阻塞；同时，可以有另一个线程执行出队，其余执行出队的线程将会被阻塞。换句话说，虽然入队和出队两个操作同时均只能有一个线程操作，但是可以一个入队线程和一个出队线程共同执行，也就意味着可能同时有两个线程在操作队列，那么为了维持线程安全，LinkedBlockingQueue使用一个AtomicInterger类型的变量表示当前队列中含有的元素个数，所以可以确保两个线程之间操作底层队列是线程安全的。</p>
<h2 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h2><p>LinkedBlockingQueue可以指定容量，内部维持一个队列，所以有一个头节点head和一个尾节点last，内部维持两把锁，一个用于入队，一个用于出队，还有锁关联的Condition对象。主要对象的定义如下：</p>
<blockquote>
<p>//容量，如果没有指定，该值为Integer.MAX_VALUE;</p>
<p>private final int capacity;</p>
<p>//当前队列中的元素</p>
<p>private final AtomicInteger count =new AtomicInteger();</p>
<p>//队列头节点，始终满足head.item==null</p>
<p>transient Node head;</p>
<p>//队列的尾节点，始终满足last.next==null</p>
<p>private transient Node last;</p>
<p>//用于出队的锁</p>
<p>private final ReentrantLock takeLock =new ReentrantLock();</p>
<p>//当队列为空时，保存执行出队的线程</p>
<p>private final Condition notEmpty = takeLock.newCondition();</p>
<p>//用于入队的锁</p>
<p>private final ReentrantLock putLock =new ReentrantLock();</p>
<p>//当队列满时，保存执行入队的线程</p>
<p>private final Condition notFull = putLock.newCondition();</p>
</blockquote>
<h3 id="put-E-e-方法"><a href="#put-E-e-方法" class="headerlink" title="put(E e)方法"></a>put(E e)方法</h3><p>put(E e)方法用于将一个元素插入到队列的尾部，其实现如下：</p>
<blockquote>
<p>public void put(E e)throws InterruptedException {</p>
<p>//不允许元素为null</p>
<p>  if (e ==null)</p>
<p>throw new NullPointerException();</p>
<p>  int c = -1;</p>
<p>  //以当前元素新建一个节点</p>
<p>  Node node =new Node(e);</p>
<p>  final ReentrantLock putLock =this.putLock;</p>
<p>  final AtomicInteger count =this.count;</p>
<p>  //获得入队的锁</p>
<p>  putLock.lockInterruptibly();</p>
<p>  try {</p>
<p>​    //如果队列已满，那么将该线程加入到Condition的等待队列中</p>
<p>​    while (count.get() == capacity) {</p>
<p>​       notFull.await();</p>
<p>​    }</p>
<p>​    //将节点入队</p>
<p>​    enqueue(node);</p>
<p>​    //得到插入之前队列的元素个数</p>
<p>​    c = count.getAndIncrement();</p>
<p>​    //如果还可以插入元素，那么释放等待的入队线程</p>
<p>​    if (c +1 &lt; capacity){</p>
<p>​       notFull.signal();</p>
<p>​    }</p>
<p>}finally {</p>
<p>//解锁</p>
<p>​    putLock.unlock();</p>
<p>  }</p>
<p>//通知出队线程队列非空</p>
<p>  if (c ==0)</p>
<p>signalNotEmpty();</p>
<p>}</p>
</blockquote>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><p><strong>3.1 具体入队与出队的原理图</strong>：</p>
<p>图中每一个节点前半部分表示封装的数据x，后边的表示指向的下一个引用。</p>
<p><img src="https://upload-images.jianshu.io/upload_images/4180398-ccb29b29b48e6192.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/132/format/webp" alt="img"></p>
<p>初始化之后，初始化一个数据为null，且head和last节点都是这个节点。</p>
<p><strong>3.2、入队两个元素过后</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4180398-0d6b2ff6b3444abf.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/436/format/webp" alt="img"></p>
<p><strong>3.3、出队一个元素后</strong></p>
<p><img src="https://upload-images.jianshu.io/upload_images/4180398-b482b1f470e2ad3a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/283/format/webp" alt="img"></p>
<h4 id="-1"><a href="#-1" class="headerlink" title=""></a></h4><h4 id="put方法总结："><a href="#put方法总结：" class="headerlink" title="put方法总结："></a>put方法总结：</h4><p>\1. LinkedBlockingQueue不允许元素为null。 </p>
<p>\2. 同一时刻，只能有一个线程执行入队操作，因为putLock在将元素插入到队列尾部时加锁了 </p>
<p>\3. 如果队列满了，那么将会调用notFull的await()方法将该线程加入到Condition等待队列中。await()方法就会释放线程占有的锁，这将导致之前由于被锁阻塞的入队线程将会获取到锁，执行到while循环处，不过可能因为由于队列仍旧是满的，也被加入到条件队列中。 </p>
<p>\4. 一旦一个出队线程取走了一个元素，并通知了入队等待队列中可以释放线程了，那么第一个加入到Condition队列中的将会被释放，那么该线程将会重新获得put锁，继而执行enqueue()方法，将节点插入到队列的尾部 </p>
<p>\5. 然后得到插入一个节点之前的元素个数，如果队列中还有空间可以插入，那么就通知notFull条件的等待队列中的线程。 </p>
<p>\6. 通知出队线程队列为空了，因为插入一个元素之前的个数为0，而插入一个之后队列中的元素就从无变成了有，就可以通知因队列为空而阻塞的出队线程了。</p>
<h2 id="E-take-方法"><a href="#E-take-方法" class="headerlink" title="E take()方法"></a>E take()方法</h2><p>take()方法用于得到队头的元素，在队列为空时会阻塞，知道队列中有元素可取。其实现如下：</p>
<blockquote>
<p>public E take() throws InterruptedException {</p>
<p>​    E x;</p>
<p>​    int c = -1;</p>
<p>​    final AtomicInteger count = this.count;</p>
<p>​    final ReentrantLock takeLock = this.takeLock;</p>
<p>​    //获取takeLock锁    </p>
<p>​     takeLock.lockInterruptibly();</p>
<p>​    try {</p>
<p>​      //如果队列为空，那么加入到notEmpty条件的等待队列中      </p>
<p>​      while (count.get() == 0) {</p>
<p>​        notEmpty.await();</p>
<p>​      }</p>
<p>​      //得到队头元素      </p>
<p>​       x = dequeue();</p>
<p>​      //得到取走一个元素之前队列的元素个数      </p>
<p>​        c = count.getAndDecrement();</p>
<p>​      //如果队列中还有数据可取，释放notEmpty条件等待队列中的第一个线程      </p>
<p>​        if (c &gt; 1)</p>
<p>​        notEmpty.signal();</p>
<p>​    } finally {</p>
<p>​      takeLock.unlock();</p>
<p>​    }</p>
<p>​    //如果队列中的元素从满到非满，通知put线程    </p>
<p>​      if (c == capacity)</p>
<p>​      signalNotFull();</p>
<p>​    return x;</p>
<p>  }</p>
</blockquote>
<h4 id="take方法总结"><a href="#take方法总结" class="headerlink" title="take方法总结:"></a>take方法总结:</h4><p>当队列为空时，就加入到notEmpty(的条件等待队列中，当队列不为空时就取走一个元素，当取完发现还有元素可取时，再通知一下自己的伙伴（等待在条件队列中的线程）；最后，如果队列从满到非满，通知一下put线程。 </p>
<h2 id="remove-方法"><a href="#remove-方法" class="headerlink" title="remove()方法"></a>remove()方法</h2><p>remove()方法用于删除队列中一个元素，如果队列中不含有该元素，那么返回false；有的话则删除并返回true。入队和出队都是只获取一个锁，而remove()方法需要同时获得两把锁，其实现如下：</p>
<blockquote>
<p>public boolean remove(Object o) {</p>
<p>​    //因为队列不包含null元素，返回false   </p>
<p>​     if (o == null) return false;</p>
<p>​    //获取两把锁    fullyLock();</p>
<p>​    try {</p>
<p>​      //从头的下一个节点开始遍历      </p>
<p>​      for (Node trail = head, p = trail.next;</p>
<p>​        p != null;</p>
<p>​        trail = p, p = p.next) {</p>
<p>​        //如果匹配，那么将节点从队列中移除，trail表示前驱节点        </p>
<p>​        if (o.equals(p.item)) {</p>
<p>​          unlink(p, trail);</p>
<p>​          return true;</p>
<p>​        }</p>
<p>​      }</p>
<p>​      return false;</p>
<p>​    } finally {</p>
<p>​      //释放两把锁     </p>
<p>​      fullyUnlock();</p>
<p>​    }</p>
<p>  }</p>
</blockquote>
<blockquote>
<p>void fullyLock() {</p>
<p>​    putLock.lock();</p>
<p>​    takeLock.lock();</p>
<p>  }</p>
</blockquote>
<h2 id="提问：为什么remove-方法同时需要两把锁"><a href="#提问：为什么remove-方法同时需要两把锁" class="headerlink" title="提问：为什么remove()方法同时需要两把锁?"></a>提问：为什么remove()方法同时需要两把锁?</h2><h2 id="LinkedBlockingQueue总结"><a href="#LinkedBlockingQueue总结" class="headerlink" title="LinkedBlockingQueue总结:"></a>LinkedBlockingQueue总结:</h2><p>LinkedBlockingQueue是允许两个线程同时在两端进行入队或出队的操作的，但一端同时只能有一个线程进行操作，这是通过两把锁来区分的；</p>
<p>为了维持底部数据的统一，引入了AtomicInteger的一个count变量，表示队列中元素的个数。count只能在两个地方变化，一个是入队的方法（可以+1），另一个是出队的方法（可以-1），而AtomicInteger是原子安全的，所以也就确保了底层队列的数据同步。 </p>
<h1 id="4-ArrayBlockingQueue源码分析"><a href="#4-ArrayBlockingQueue源码分析" class="headerlink" title="4. ArrayBlockingQueue源码分析"></a>4. ArrayBlockingQueue源码分析</h1><p>ArrayBlockingQueue底层是使用一个数组实现队列的，并且在构造ArrayBlockingQueue时需要指定容量，也就意味着底层数组一旦创建了，容量就不能改变了，因此ArrayBlockingQueue是一个容量限制的阻塞队列。因此，在队列全满时执行入队将会阻塞，在队列为空时出队同样将会阻塞。</p>
<p>ArrayBlockingQueue的重要字段有如下几个：</p>
<blockquote>
<p>​    /** The queued items */ </p>
<p>​     final Object[] items;</p>
<p>   /** Main lock guarding all access */ </p>
<p>​    final ReentrantLock lock;</p>
<p>  /** Condition for waiting takes */  </p>
<p>   private final Condition notEmpty;</p>
<p>  /** Condition for waiting puts */  </p>
<p>   private final Condition notFull;</p>
</blockquote>
<h2 id="put-E-e-方法-1"><a href="#put-E-e-方法-1" class="headerlink" title="put(E e)方法"></a>put(E e)方法</h2><p>put(E e)方法在队列不满的情况下，将会将元素添加到队列尾部，如果队列已满，将会阻塞，直到队列中有剩余空间可以插入。该方法的实现如下：</p>
<blockquote>
<p>public void put(E e) throws InterruptedException {</p>
<p>​    //检查元素是否为null，如果是，抛出NullPointerException    </p>
<p>​    checkNotNull(e);</p>
<p>​    final ReentrantLock lock = this.lock;</p>
<p>​    //加锁    </p>
<p>​    lock.lockInterruptibly();</p>
<p>​    try {</p>
<p>​      //如果队列已满，阻塞，等待队列成为不满状态      </p>
<p>​      while (count == items.length)</p>
<p>​        notFull.await();</p>
<p>​      //将元素入队      </p>
<p>​      enqueue(e);</p>
<p>​    } finally {</p>
<p>​      lock.unlock();</p>
<p>​    }</p>
<p>  }</p>
</blockquote>
<h2 id="put方法总结"><a href="#put方法总结" class="headerlink" title="put方法总结:"></a>put方法总结:</h2><p>\1. ArrayBlockingQueue不允许元素为null </p>
<p>\2. ArrayBlockingQueue在队列已满时将会调用notFull的await()方法释放锁并处于阻塞状态 </p>
<p>\3. 一旦ArrayBlockingQueue不为满的状态，就将元素入队</p>
<h2 id="E-take-方法-1"><a href="#E-take-方法-1" class="headerlink" title="E take()方法"></a><strong>E take()方法</strong></h2><p>take()方法用于取走队头的元素，当队列为空时将会阻塞，直到队列中有元素可取走时将会被释放。其实现如下：</p>
<blockquote>
<p>public E take() throws InterruptedException {</p>
<p>​    final ReentrantLock lock = this.lock;</p>
<p>​    //首先加锁    </p>
<p>​     lock.lockInterruptibly();</p>
<p>​    try {</p>
<p>​      //如果队列为空，阻塞      </p>
<p>​      while (count == 0)</p>
<p>​        notEmpty.await();</p>
<p>​      //队列不为空，调用dequeue()出队      </p>
<p>​      return dequeue();</p>
<p>​    } finally {</p>
<p>​      //释放锁      </p>
<p>​     lock.unlock();</p>
<p>​    }</p>
<p>  }</p>
</blockquote>
<h3 id="take方法总结-1"><a href="#take方法总结-1" class="headerlink" title="take方法总结:"></a>take方法总结:</h3><p>一旦获得了锁之后，如果队列为空，那么将阻塞；否则调用dequeue()出队一个元素。 </p>
<h2 id="ArrayBlockingQueue总结："><a href="#ArrayBlockingQueue总结：" class="headerlink" title="ArrayBlockingQueue总结："></a>ArrayBlockingQueue总结：</h2><p>ArrayBlockingQueue的并发阻塞是通过ReentrantLock和Condition来实现的，ArrayBlockingQueue内部只有一把锁，意味着同一时刻只有一个线程能进行入队或者出队的操作。</p>
<h1 id="5-总结"><a href="#5-总结" class="headerlink" title="5 总结"></a>5 总结</h1><p>在上面分析LinkedBlockingQueue的源码之后，可以与ArrayBlockingQueue做一个比较。 </p>
<h2 id="ArrayBlockingQueue："><a href="#ArrayBlockingQueue：" class="headerlink" title="ArrayBlockingQueue："></a>ArrayBlockingQueue：</h2><p>一个对象数组+一把锁+两个条件</p>
<p>入队与出队都用同一把锁</p>
<p>在只有入队高并发或出队高并发的情况下，因为操作数组，且不需要扩容，性能很高</p>
<p>采用了数组，必须指定大小，即容量有限</p>
<h2 id="LinkedBlockingQueue："><a href="#LinkedBlockingQueue：" class="headerlink" title="LinkedBlockingQueue："></a>LinkedBlockingQueue：</h2><p>一个单向链表+两把锁+两个条件</p>
<p>两把锁，一把用于入队，一把用于出队，有效的避免了入队与出队时使用一把锁带来的竞争。</p>
<p>在入队与出队都高并发的情况下，性能比ArrayBlockingQueue高很多</p>
<p>采用了链表，最大容量为整数最大值，可看做容量无限</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/JWT%20token%E6%9C%BA%E5%88%B6%E7%A0%94%E7%A9%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/JWT%20token%E6%9C%BA%E5%88%B6%E7%A0%94%E7%A9%B6/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-06-19 12:29:16" itemprop="dateModified" datetime="2020-06-19T12:29:16+08:00">2020-06-19</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="JWT-token机制研究"><a href="#JWT-token机制研究" class="headerlink" title="JWT token机制研究"></a>JWT token机制研究</h1><h4 id="什么是JWT"><a href="#什么是JWT" class="headerlink" title="什么是JWT?"></a>什么是JWT?</h4><p>JWT(json web token)， 是基于<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3adfc2f8e15f#">RFC7519</a>定义的实现双方传输可信数据的安全机制。打个比方：JWT是有领导签字的文书，因为有领导签字，所以我确定对方是合法的，不是别人冒充的。那如何确认这个签字是合法的呢？这个涉及到JWT的签名机制，下面会详细讨论。</p>
<h4 id="如何使用JWT"><a href="#如何使用JWT" class="headerlink" title="如何使用JWT?"></a>如何使用JWT?</h4><p><img src="https://upload-images.jianshu.io/upload_images/2230743-e2db44af8e810d38.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/800/format/webp" alt="img"></p>
<p>jwt.png</p>
<p>1 用户使用用户名/密码，向认证服务器请求。</p>
<p>2 认证服务器认证通过后，生成JWT token返回给用户</p>
<p>3 用户向应用服务器调用API请求资源时都需添加JWT token</p>
<p>4 应用服务器接收请求后先取出JWT token进行校验，通过后返回有效资源，否则返回错误。</p>
<p>JWT由三部分组成：Header，Payload和Signature。</p>
<p>格式是以字符串信息，由逗号分隔</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">header</span><span class="selector-class">.payload</span><span class="selector-class">.signature</span></span><br></pre></td></tr></table></figure>

<h4 id="1-创建header"><a href="#1-创建header" class="headerlink" title="1 创建header"></a>1 创建header</h4><p>Header json格式如下</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;    <span class="attr">&quot;type&quot;</span> : <span class="string">&quot;JWT&quot;</span>,    <span class="attr">&quot;alg&quot;</span> : <span class="string">&quot;HS256&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>type: 指明这个object是JWT.</p>
<p>alg: 指明使用什么签名算法，上面例子中使用的是HMAC-SHA256 摘要算法。</p>
<h4 id="2-创建payload"><a href="#2-创建payload" class="headerlink" title="2 创建payload"></a>2 创建payload</h4><p>Payload, 是存储在JWT的数据，在<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3adfc2f8e15f#">JWT协议</a>中定义为claims。</p>
<p>json格式如下：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;    <span class="attr">&quot;iss&quot;</span> : <span class="string">&quot;gd.com&quot;</span>,    <span class="attr">&quot;sub&quot;</span> : <span class="string">&quot;userId&quot;</span>,    <span class="attr">&quot;exp&quot;</span> : <span class="string">&quot;3600&quot;</span>,    <span class="attr">&quot;iat&quot;</span> : <span class="string">&quot;2012553355235&quot;</span>&#125;</span><br></pre></td></tr></table></figure>

<p>协议定义了几个标准claims,</p>
<p>“iss” issuer 请求JWT一方</p>
<p>“sub” “subject”</p>
<p>“exp” : 过期时间</p>
<p>“iat” : “issued at”, 请求JWT的时间，可用来判断JWT是否过期。</p>
<p>以上claim是可选的，根据业务添加，也可以根据实际需求自定义claim。但需要注意的是payload的大小会影响生成JWT token后的大小。过大的JWT token会导致延迟和性能下降等负面影响。</p>
<h4 id="3创建签名："><a href="#3创建签名：" class="headerlink" title="3创建签名："></a>3创建签名：</h4><p>签名过程参考伪代码如下:</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">data</span> = base64urlEncode( header ) + “.” + base64urlEncode( payload )signature = Hash( <span class="keyword">data</span>, secret );</span><br></pre></td></tr></table></figure>

<p>使用base64对header和payload编码生成字符串，然后用逗号(.)拼接成data字串。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// headereyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9// payloadeyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ</span></span><br></pre></td></tr></table></figure>

<p>对data字串使用摘要算法(比如的HS256)生成签名.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// signature-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM</span></span><br></pre></td></tr></table></figure>

<p>然后将三部分用逗号拼接逗号(.)生成JWT token</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JWT TokeneyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJ1c2VySWQiOiJiMDhmODZhZi0zNWRhLTQ4ZjItOGZhYi1jZWYzOTA0NjYwYmQifQ.-xN_h82PHVTCMA9vdoHrcZxH-x5mb11y1537t3rGzcM</span></span><br></pre></td></tr></table></figure>

<h4 id="JWT如何保护我们的数据？"><a href="#JWT如何保护我们的数据？" class="headerlink" title="JWT如何保护我们的数据？"></a>JWT如何保护我们的数据？</h4><p>从JWT token的生成过程了解，JWT对数据进行的是签名而不是加密，所以JWT的payload部分不适合存放敏感数据，实际使用中需使用HTTPS，防止JWT token被非法拦截。理解加密和签名的区别，请<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3adfc2f8e15f#">参考此文</a></p>
<h4 id="验证JWT："><a href="#验证JWT：" class="headerlink" title="验证JWT："></a>验证JWT：</h4><p>在如何使用JWT的第4步中，应用服务器获取用户请求带的JWT token后，取出header和payload重新签名然后和原签名比较，比较一致则验证通过，不一致则说明该用户是非法请求拒绝。</p>
<h4 id="refresh-token-机制："><a href="#refresh-token-机制：" class="headerlink" title="refresh token 机制："></a>refresh token 机制：</h4><p>可参考：<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3adfc2f8e15f#">https://vimsky.com/article/3601.html</a>，采用Auth0的处理思路。</p>
<h4 id="JWT和OAuth的关系："><a href="#JWT和OAuth的关系：" class="headerlink" title="JWT和OAuth的关系："></a>JWT和OAuth的关系：</h4><p>两者没有任何关系，JWT是认证机制，OAuth是一套授权框架。OAuth的Access Token，Refresh Token也可以使用JWT形式。</p>
<h4 id="好用的JWT-三方框架："><a href="#好用的JWT-三方框架：" class="headerlink" title="好用的JWT 三方框架："></a>好用的JWT 三方框架：</h4><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3adfc2f8e15f#">https://github.com/jwtk/jjwt</a></p>
<p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3adfc2f8e15f#">https://github.com/pac4j/pac4j</a></p>
<h4 id="好用的demo："><a href="#好用的demo：" class="headerlink" title="好用的demo："></a>好用的demo：</h4><p><a target="_blank" rel="noopener" href="https://link.jianshu.com/?t=https://github.com/szerhusenBC/jwt-spring-security-demo">https://github.com/szerhusenBC/jwt-spring-security-demo</a></p>
<h4 id="引用："><a href="#引用：" class="headerlink" title="引用："></a>引用：</h4><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/3adfc2f8e15f#">5 Easy Steps to Understanding JSON Web Tokens (JWT)</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/MyBatis%E4%BD%BF%E7%94%A8association%E5%AE%9E%E7%8E%B0%E4%B8%80%E5%AF%B9%E4%B8%80%E7%BA%A7%E8%81%94%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%87%A0%E7%A7%8D%E6%A1%88%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/MyBatis%E4%BD%BF%E7%94%A8association%E5%AE%9E%E7%8E%B0%E4%B8%80%E5%AF%B9%E4%B8%80%E7%BA%A7%E8%81%94%E6%9F%A5%E8%AF%A2%E7%9A%84%E5%87%A0%E7%A7%8D%E6%A1%88%E4%BE%8B/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-07-30 17:00:53" itemprop="dateModified" datetime="2020-07-30T17:00:53+08:00">2020-07-30</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MyBatis使用association实现一对一级联查询的几种案例"><a href="#MyBatis使用association实现一对一级联查询的几种案例" class="headerlink" title="MyBatis使用association实现一对一级联查询的几种案例"></a>MyBatis使用association实现一对一级联查询的几种案例</h1><p>我们平日经常会遇到需要级联查询的场景，这里通过案例给大家展示实现过程。我们要查询的用户信息里面有个角色信息，一个用户对应一个角色，我们现在要求查出用户信息的同时，关联查出用户的角色信息，那么这个时候我们可以通过级联属性的方式，将角色中的数据查出来封装到用户User的role属性里面，我们还有另外一种方式来实现数据的封装。接下来我们将介绍一下association标签的相关用法，包括<strong>嵌套查询</strong>和<strong>分段查询</strong>两种方式。</p>
<p>准备工作：</p>
<h4 id="在Oracle数据库新建两张数据库表t-user和t-role，并插入若干条数据"><a href="#在Oracle数据库新建两张数据库表t-user和t-role，并插入若干条数据" class="headerlink" title="在Oracle数据库新建两张数据库表t_user和t_role，并插入若干条数据"></a><strong>在Oracle数据库新建两张数据库表t_user和t_role，并插入若干条数据</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CREATE TABLE t_user (</span><br><span class="line">    id NUMBER(2) NOT NULL,</span><br><span class="line">    userName varchar2(100) DEFAULT NULL,</span><br><span class="line">    roleId NUMBER(2),</span><br><span class="line">    note varchar2(255) DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">  ) </span><br><span class="line">INSERT INTO t_user(id,userName,roleId,note) VALUES (1, &#x27;张三&#x27;, 1, &#x27;负责编码&#x27;);</span><br><span class="line">INSERT INTO t_user(id,userName,roleId,note) VALUES (2, &#x27;李四&#x27;, 2, &#x27;负责测试&#x27;);</span><br><span class="line">INSERT INTO t_user(id,userName,roleId,note) VALUES (3, &#x27;王五&#x27;, 3, &#x27;产品设计&#x27;);</span><br><span class="line">CREATE TABLE t_role (</span><br><span class="line">  id NUMBER(2) NOT NULL,</span><br><span class="line">  roleName varchar(20) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">)</span><br><span class="line">INSERT INTO t_role(id,roleName) VALUES (1,&#x27;JAVA工程师&#x27;);</span><br><span class="line">INSERT INTO t_role(id,roleName) VALUES (2,&#x27;测试工程师&#x27;);</span><br><span class="line">INSERT INTO t_role(id,roleName) VALUES (3,&#x27;产品经理&#x27;);</span><br></pre></td></tr></table></figure>

<h4 id="新建JavaBean类-User"><a href="#新建JavaBean类-User" class="headerlink" title="新建JavaBean类 User"></a><strong>新建JavaBean类 User</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 博客地址  https://blog.csdn.net/guobinhui</span><br><span class="line"> */</span><br><span class="line">package com.hoomsun.wealth.crm.model;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 作者：guo bin hui <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> * 创建时间：2018年7月3日 <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> * 描述：</span><br><span class="line"> */</span><br><span class="line">public class User &#123;</span><br><span class="line"></span><br><span class="line">	// ID，唯一性</span><br><span class="line">	private int id;</span><br><span class="line">	// 用户名</span><br><span class="line">	private String userName;</span><br><span class="line">	// 角色</span><br><span class="line">	private Role role;</span><br><span class="line">	// 备注</span><br><span class="line">	private String note;</span><br><span class="line">	public int getId() &#123;</span><br><span class="line">		return id;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setId(int id) &#123;</span><br><span class="line">		this.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	public String getUserName() &#123;</span><br><span class="line">		return userName;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setUserName(String userName) &#123;</span><br><span class="line">		this.userName = userName;</span><br><span class="line">	&#125;</span><br><span class="line">	public Role getRole() &#123;</span><br><span class="line">		return role;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public void setRole(Role role) &#123;</span><br><span class="line">		this.role = role;</span><br><span class="line">	&#125;</span><br><span class="line">	public String getNote() &#123;</span><br><span class="line">		return note;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setNote(String note) &#123;</span><br><span class="line">		this.note = note;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="新建JavaBean类-Role"><a href="#新建JavaBean类-Role" class="headerlink" title="新建JavaBean类 Role"></a><strong>新建JavaBean类 Role</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 博客地址  https://blog.csdn.net/guobinhui</span><br><span class="line"> */</span><br><span class="line">package com.hoomsun.wealth.crm.model;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * 作者：guo bin hui <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> * 创建时间：2018年7月3日 <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * 描述：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public class Role &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	private int id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	private String roleName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public int getId() &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		return id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public void setId(int id) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		this.id = id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public String getRoleName() &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		return roleName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public void setRoleName(String roleName) &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		this.roleName = roleName;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h4 id="新建接口类UserMapper-java，增加接口方法getUserById"><a href="#新建接口类UserMapper-java，增加接口方法getUserById" class="headerlink" title="新建接口类UserMapper.java，增加接口方法getUserById"></a><strong>新建接口类UserMapper.java，增加接口方法getUserById</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * 博客地址  https://blog.csdn.net/guobinhui</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">package com.hoomsun.wealth.crm.dao;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">import com.hoomsun.wealth.crm.model.User;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * 作者：Administrator <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * 创建时间：2018年7月3日 <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> * 描述：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">public interface UserMapper &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public User getUserById(Integer id);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>接下来我们将分步介绍<strong>嵌套查询</strong>实现方式</p>
<p><strong>方式一</strong></p>
<h4 id="UserMapper-xml文件如下："><a href="#UserMapper-xml文件如下：" class="headerlink" title="UserMapper.xml文件如下："></a><strong>UserMapper.xml文件如下：</strong></h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br></pre></td><td class="code"><pre><span class="line">MyBatis使用association实现一对一级联查询的几种案例</span><br><span class="line"></span><br><span class="line">guobinhui 2018-07-03 17:44:20  1997  收藏</span><br><span class="line">分类专栏： Java基础 编程笔记</span><br><span class="line">版权</span><br><span class="line">我们平日经常会遇到需要级联查询的场景，这里通过案例给大家展示实现过程。我们要查询的用户信息里面有个角色信息，一个用户对应一个角色，我们现在要求查出用户信息的同时，关联查出用户的角色信息，那么这个时候我们可以通过级联属性的方式，将角色中的数据查出来封装到用户User的role属性里面，我们还有另外一种方式来实现数据的封装。接下来我们将介绍一下association标签的相关用法，包括嵌套查询和分段查询两种方式。</span><br><span class="line"></span><br><span class="line">准备工作：</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在Oracle数据库新建两张数据库表t_user和t_role，并插入若干条数据</span><br><span class="line">CREATE TABLE t_user (</span><br><span class="line">    id NUMBER(2) NOT NULL,</span><br><span class="line">    userName varchar2(100) DEFAULT NULL,</span><br><span class="line">    roleId NUMBER(2),</span><br><span class="line">    note varchar2(255) DEFAULT NULL,</span><br><span class="line">    PRIMARY KEY (id)</span><br><span class="line">  ) </span><br><span class="line">INSERT INTO t_user(id,userName,roleId,note) VALUES (1, &#x27;张三&#x27;, 1, &#x27;负责编码&#x27;);</span><br><span class="line">INSERT INTO t_user(id,userName,roleId,note) VALUES (2, &#x27;李四&#x27;, 2, &#x27;负责测试&#x27;);</span><br><span class="line">INSERT INTO t_user(id,userName,roleId,note) VALUES (3, &#x27;王五&#x27;, 3, &#x27;产品设计&#x27;);</span><br><span class="line">CREATE TABLE t_role (</span><br><span class="line">  id NUMBER(2) NOT NULL,</span><br><span class="line">  roleName varchar(20) DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (id)</span><br><span class="line">)</span><br><span class="line">INSERT INTO t_role(id,roleName) VALUES (1,&#x27;JAVA工程师&#x27;);</span><br><span class="line">INSERT INTO t_role(id,roleName) VALUES (2,&#x27;测试工程师&#x27;);</span><br><span class="line">INSERT INTO t_role(id,roleName) VALUES (3,&#x27;产品经理&#x27;);</span><br><span class="line">新建JavaBean类 User</span><br><span class="line">/**</span><br><span class="line"> * 博客地址  https://blog.csdn.net/guobinhui</span><br><span class="line"> */</span><br><span class="line">package com.hoomsun.wealth.crm.model;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line"> * 作者：guo bin hui <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> * 创建时间：2018年7月3日 <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> * 描述：</span><br><span class="line"> */</span><br><span class="line">public class User &#123;</span><br><span class="line"> </span><br><span class="line">	// ID，唯一性</span><br><span class="line">	private int id;</span><br><span class="line">	// 用户名</span><br><span class="line">	private String userName;</span><br><span class="line">	// 角色</span><br><span class="line">	private Role role;</span><br><span class="line">	// 备注</span><br><span class="line">	private String note;</span><br><span class="line">	public int getId() &#123;</span><br><span class="line">		return id;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setId(int id) &#123;</span><br><span class="line">		this.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	public String getUserName() &#123;</span><br><span class="line">		return userName;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setUserName(String userName) &#123;</span><br><span class="line">		this.userName = userName;</span><br><span class="line">	&#125;</span><br><span class="line">	public Role getRole() &#123;</span><br><span class="line">		return role;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setRole(Role role) &#123;</span><br><span class="line">		this.role = role;</span><br><span class="line">	&#125;</span><br><span class="line">	public String getNote() &#123;</span><br><span class="line">		return note;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setNote(String note) &#123;</span><br><span class="line">		this.note = note;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">新建JavaBean类 Role</span><br><span class="line">/**</span><br><span class="line"> * 博客地址  https://blog.csdn.net/guobinhui</span><br><span class="line"> */</span><br><span class="line">package com.hoomsun.wealth.crm.model;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line"> * 作者：guo bin hui <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> * 创建时间：2018年7月3日 <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> * 描述：</span><br><span class="line"> */</span><br><span class="line">public class Role &#123;</span><br><span class="line"> </span><br><span class="line">	private int id;</span><br><span class="line">	private String roleName;</span><br><span class="line">	public int getId() &#123;</span><br><span class="line">		return id;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setId(int id) &#123;</span><br><span class="line">		this.id = id;</span><br><span class="line">	&#125;</span><br><span class="line">	public String getRoleName() &#123;</span><br><span class="line">		return roleName;</span><br><span class="line">	&#125;</span><br><span class="line">	public void setRoleName(String roleName) &#123;</span><br><span class="line">		this.roleName = roleName;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">新建接口类UserMapper.java，增加接口方法getUserById</span><br><span class="line">/**</span><br><span class="line"> * 博客地址  https://blog.csdn.net/guobinhui</span><br><span class="line"> */</span><br><span class="line">package com.hoomsun.wealth.crm.dao;</span><br><span class="line"> </span><br><span class="line">import com.hoomsun.wealth.crm.model.User;</span><br><span class="line"> </span><br><span class="line">/**</span><br><span class="line"> * 作者：Administrator <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> * 创建时间：2018年7月3日 <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"> * 描述：</span><br><span class="line"> */</span><br><span class="line">public interface UserMapper &#123;</span><br><span class="line"> </span><br><span class="line">	public User getUserById(Integer id);</span><br><span class="line">&#125;</span><br><span class="line">接下来我们将分步介绍嵌套查询实现方式</span><br><span class="line"></span><br><span class="line">方式一</span><br><span class="line"></span><br><span class="line">UserMapper.xml文件如下：</span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.hoomsun.wealth.crm.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.hoomsun.wealth.crm.model.User&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userName&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;note&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span> <span class="attr">property</span>=<span class="string">&quot;note&quot;</span> /&gt;</span>		</span><br><span class="line">	   <span class="comment">&lt;!--assocication可以指定联合的JavaBean对象 </span></span><br><span class="line"><span class="comment">               property=&quot;role&quot;指定关联查询的Role 类型的role 属性</span></span><br><span class="line"><span class="comment">               javaType:指定这个role属性对象的类型</span></span><br><span class="line"><span class="comment">            --&gt;</span>	</span><br><span class="line">	    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;role&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.hoomsun.wealth.crm.model.Role&quot;</span>&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;role_id&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">	    	<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;roleName&quot;</span> <span class="attr">property</span>=<span class="string">&quot;roleName&quot;</span>/&gt;</span></span><br><span class="line">	    <span class="tag">&lt;/<span class="name">association</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">		select u.id id,</span><br><span class="line">		u.userName userName,u.note note,r.id role_id, r.roleName roleName</span><br><span class="line">		from t_user u left join t_role r on u.roleId=r.id</span><br><span class="line">		where u.id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line">方式二</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.hoomsun.wealth.crm.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.hoomsun.wealth.crm.model.User&quot;</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userName&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;note&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span> <span class="attr">property</span>=<span class="string">&quot;note&quot;</span> /&gt;</span>	</span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;role.id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;role_id&quot;</span> /&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;role.roleName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;roleName&quot;</span> /&gt;</span>			</span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"> </span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line">		select u.id id,</span><br><span class="line">		u.userName userName,u.note note,r.id role_id, r.roleName roleName</span><br><span class="line">		from t_user u left join t_role r on u.roleId=r.id</span><br><span class="line">		where u.id=#&#123;id&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br><span class="line"></span><br><span class="line">接着在PostMan上测试一下，断点查看返回数据格式如下:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">这样我们就通过association实现了关联属性的查询，使用association定义关联的单个对象的封装结果。</span><br><span class="line">至此，我们关于MyBatis使用association解决一对一关联查询介绍完毕。</span><br></pre></td></tr></table></figure>

<p><strong>方式二</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.hoomsun.wealth.crm.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.hoomsun.wealth.crm.model.User&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">id</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;INTEGER&quot;</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;userName&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;VARCHAR&quot;</span> <span class="attr">property</span>=<span class="string">&quot;userName&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">column</span>=<span class="string">&quot;note&quot;</span> <span class="attr">jdbcType</span>=<span class="string">&quot;DECIMAL&quot;</span> <span class="attr">property</span>=<span class="string">&quot;note&quot;</span> /&gt;</span>	</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;role.id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;role_id&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;role.roleName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;roleName&quot;</span> /&gt;</span>			</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getUserById&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;userResultMap&quot;</span> <span class="attr">parameterType</span>=<span class="string">&quot;java.lang.Integer&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		select u.id id,</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		u.userName userName,u.note note,r.id role_id, r.roleName roleName</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		from t_user u left join t_role r on u.roleId=r.id</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		where u.id=#&#123;id&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>接着在PostMan上测试一下，断点查看返回数据格式如下:</p>
<p><img src="https://img-blog.csdn.net/20180703173919319?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2d1b2Jpbmh1aQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"></p>
<p><img src="https://img-blog.csdn.net/2018070317402568?watermark/2/text/aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2d1b2Jpbmh1aQ==/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70" alt="img"><br>这样我们就通过association实现了关联属性的查询，使用association定义关联的单个对象的封装结果。<br>至此，我们关于MyBatis使用association解决一对一关联查询介绍完毕。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/knife4j--Swagger%E7%94%9F%E6%88%90Api%E6%96%87%E6%A1%A3%E7%9A%84%E5%A2%9E%E5%BC%BA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/knife4j--Swagger%E7%94%9F%E6%88%90Api%E6%96%87%E6%A1%A3%E7%9A%84%E5%A2%9E%E5%BC%BA%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-07-09 12:46:05" itemprop="dateModified" datetime="2020-07-09T12:46:05+08:00">2020-07-09</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="knife4j–Swagger生成Api文档的增强解决方案"><a href="#knife4j–Swagger生成Api文档的增强解决方案" class="headerlink" title="knife4j–Swagger生成Api文档的增强解决方案"></a>knife4j–Swagger生成Api文档的增强解决方案</h1><hr>
<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><p>knife4j是为Java MVC框架集成Swagger生成Api文档的增强解决方案,前身是swagger-bootstrap-ui,取名kni4j是希望它能像一把匕首一样小巧,轻量,并且功能强悍!</p>
<blockquote>
<p>Knife4j提供导出4种格式的离线文档(Html\Markdown\Word\Pdf)</p>
</blockquote>
<p>目前项目主要的模块如下：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLWZkYmZhMGJhNzFiYTAzNmIucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvODMxL2Zvcm1hdC93ZWJw?x-oss-process=image/format,png" alt="img"></p>
<h1 id="开源仓库"><a href="#开源仓库" class="headerlink" title="开源仓库"></a>开源仓库</h1><p>Github</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://github.com/xiaoymin/swagger-bootstrap-ui">https://github.com/xiaoymin/swagger-bootstrap-ui</a></p>
</blockquote>
<p>码云</p>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://gitee.com/xiaoym/knife4j">https://gitee.com/xiaoym/knife4j</a></p>
</blockquote>
<h1 id="功能特性"><a href="#功能特性" class="headerlink" title="功能特性"></a>功能特性</h1><ul>
<li><h2 id="简洁"><a href="#简洁" class="headerlink" title="简洁"></a><strong>简洁</strong></h2></li>
</ul>
<p>基于左右菜单式的布局方式,是更符合国人的操作习惯吧.文档更清晰…</p>
<ul>
<li><h2 id="个性化配置"><a href="#个性化配置" class="headerlink" title="个性化配置"></a><strong>个性化配置</strong></h2></li>
</ul>
<p>个性化配置项,支持接口地址、接口description属性、UI增强等个性化配置功能…</p>
<blockquote>
<p>该UI增强包主要包括两大核心功能：文档说明 和 在线调试</p>
<ol>
<li>文档说明：根据Swagger的规范说明，详细列出接口文档的说明，包括接口地址、类型、请求示例、请求参数、响应示例、响应参数、响应码等信息，使用swagger-bootstrap-ui能根据该文档说明，对该接口的使用情况一目了然。</li>
<li>在线调试：提供在线接口联调的强大功能，自动解析当前接口参数,同时包含表单验证，调用参数可返回接口响应内容、headers、Curl请求命令实例、响应时间、响应状态码等信息，帮助开发者在线调试，而不必通过其他测试工具测试接口是否正确,简介、强大。</li>
</ol>
</blockquote>
<ul>
<li><h2 id="增强"><a href="#增强" class="headerlink" title="增强"></a><strong>增强</strong></h2></li>
</ul>
<p>接口排序、Swagger资源保护、导出Markdown、参数缓存众多强大功能…</p>
<h1 id="在线预览"><a href="#在线预览" class="headerlink" title="在线预览"></a>在线预览</h1><blockquote>
<p><a target="_blank" rel="noopener" href="http://knife4j.xiaominfo.com/doc.html">http://knife4j.xiaominfo.com/doc.html</a></p>
</blockquote>
<h1 id="使用简介"><a href="#使用简介" class="headerlink" title="使用简介"></a>使用简介</h1><ul>
<li><h2 id="单纯皮肤增强"><a href="#单纯皮肤增强" class="headerlink" title="单纯皮肤增强"></a>单纯皮肤增强</h2></li>
</ul>
<p>不使用增强功能,纯粹换一个swagger的前端皮肤，这种情况是最简单的,你项目结构下无需变更</p>
<p>可以直接引用swagger-bootstrap-ui的最后一个版本1.9.6或者使用knife4j-spring-ui</p>
<h3 id="老版本引用"><a href="#老版本引用" class="headerlink" title="老版本引用"></a>老版本引用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;artifactId&gt;swagger-bootstrap-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;version&gt;1.9.6&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="新版本引用"><a href="#新版本引用" class="headerlink" title="新版本引用"></a>新版本引用</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;artifactId&gt;knife4j-spring-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;version&gt;$&#123;lastVersion&#125;&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<ul>
<li><h2 id="Spring-Boot项目单体架构使用增强功能"><a href="#Spring-Boot项目单体架构使用增强功能" class="headerlink" title="Spring Boot项目单体架构使用增强功能"></a>Spring Boot项目单体架构使用增强功能</h2></li>
</ul>
<p>在SpringBoot单体架构下,knife4j提供了starter供开发者快速使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;artifactId&gt;knife4j-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;version&gt;$&#123;knife4j.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>该包会引用所有的knife4j提供的资源，包括前端Ui的jar包</p>
<ul>
<li><h2 id="Spring-Cloud微服务架构"><a href="#Spring-Cloud微服务架构" class="headerlink" title="Spring Cloud微服务架构"></a>Spring Cloud微服务架构</h2></li>
</ul>
<p>在Spring Cloud的微服务架构下,每个微服务其实并不需要引入前端的Ui资源,因此在每个微服务的SpringBoot项目下,引入knife4j提供的微服务starter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;artifactId&gt;knife4j-micro-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  &lt;version&gt;$&#123;knife4j.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>在网关聚合文档服务下,可以再把前端的ui资源引入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &lt;groupId&gt;com.github.xiaoymin&lt;&#x2F;groupId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &lt;artifactId&gt;knife4j-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &lt;version&gt;$&#123;knife4j.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h1 id="快速开始"><a href="#快速开始" class="headerlink" title="快速开始"></a>快速开始</h1><p>相信使用过springboot的人大都知道和用过swagger，knife4j的使用方法和swagger几乎一模一样，没有什么学习成本，不同的是展示的接口UI文档更加友好和人性化。下面开始演示一个集成项目，首先来看pom文件依赖：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLWIyM2UwOWQ4M2Q0NWY0NzkucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvODgyL2Zvcm1hdC93ZWJw?x-oss-process=image/format,png" alt="img"></p>
<p>只需要引入一个knife4j的starter即可，不用其它依赖，该包会引用所有的knife4j提供的资源，包括前端Ui的jar包。</p>
<p>springboot的配置文件和启动类不用做任何特殊配置，使用knife4j需要一个swagger的配置类，这个配置类和以前使用swagger几乎是一样的：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTJkNzQzMzBhYWE2OGFmMGMucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTE2NC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<p>可以看到，内容上没什么变化，唯一的变化是类注解需要比原来的swagger多加一个 @EnableSwaggerBootstrapUi。这样knife4j的所有配置都完成了，启动项目可以访问地址：</p>
<blockquote>
<p>认访问地址是：<code>http://$&#123;host&#125;:$&#123;port&#125;/doc.html</code></p>
</blockquote>
<p>来看一下效果：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTFjOWY5ODMzMmU5OWRhNTgucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<h1 id="配置简单接口"><a href="#配置简单接口" class="headerlink" title="配置简单接口"></a>配置简单接口</h1><p>下面来配置一个简单的接口，查看文档的展示效果。首先来看接口的通用返回结果模型定义：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTc0MzIxZTEyZjc2Zjg0MDkucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTEzNS9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<p>注意要在文档上面展示，需要使用图中的注解。这个通用结果的具体数据是一个泛型类型。下面我们定义一个具体的业务数据模型：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTliN2U5YjA0NjQ1YmU2ZWIucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvOTc2L2Zvcm1hdC93ZWJw?x-oss-process=image/format,png" alt="img"></p>
<p>通过上面两个的定义，接口的返回类型就搞定了，下面来看接口：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTI5OWMxODljNDZkOTdjMTAucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<p>这个接口类中分为几个部分需要注意，第一是类上面的@Api注解，描述了整个类的接口分类含义。还有一个是每个接口上面的 @ApiImplicitParams 注解，定义了接口的所有参数。还有@ApiResponses注解，定义了返回时，所有状态码所代表的的含义，最后是@ApiOperation注解，描述了单个接口本身的功能。</p>
<p>定义接口完成后，我们来重启项目，查看文档的效果：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTgxOTg0YzM5MWQ1NWI0NzQucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<p>首页上面有一些变化，左侧列表多了HelloController类的整体描述栏目，我们点开这个栏目，可以看到类中定义的所有接口：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTQ0YjJlNTkxZTBhMTM2NjkucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMzI2L2Zvcm1hdC93ZWJw?x-oss-process=image/format,png" alt="img"></p>
<p>点击这个接口，看到右侧非常详细的接口文档：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLWYxZmFkMTgyMzRiZmQ0ZDAucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<p>上图中展示的是接口地址，接口类型，接口描述和详细的入参描述，下面的相应状态展示了我们定义的两种状态类型，还有接口的回参也非常详细的列了出来：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTIyMGJiZDUxNjBiYmM0Y2MucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<p>文字描述类型，数据结构，类型都有，还有响应示例，可以说非常清晰了。个人认为这种展示效果比原来的swagger要友好很多。</p>
<p>右侧还有调试功能，可以直接使用来测试接口：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTE0OGZlZjNiMmNhMThjOWUucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<p>在左侧的文档管理中，还可以设置全局参数，支持类似jwt的带权限的测试：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLTRiNjg0MGI4NmFmMzUzNzcucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<p>对文档还可以进行个性化设置：</p>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLWU3NDRmNDYyNjQyZGFiYjEucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>上面简单介绍和演示了knife4j，这个starter不仅支持swagger-bootstrap-ui，原始的swagger-ui还是可以使用的:</p>
<blockquote>
<ul>
<li>访问地址 http://<code>$&#123;host&#125;:$&#123;port&#125;</code>/swagger-ui.html</li>
</ul>
</blockquote>
<p><img src="https://imgconvert.csdnimg.cn/aHR0cHM6Ly91cGxvYWQtaW1hZ2VzLmppYW5zaHUuaW8vdXBsb2FkX2ltYWdlcy8zNjczODkxLWU1Y2U5ZDdlYzQ3NTA0OGEucG5nP2ltYWdlTW9ncjIvYXV0by1vcmllbnQvc3RyaXB8aW1hZ2VWaWV3Mi8yL3cvMTIwMC9mb3JtYXQvd2VicA?x-oss-process=image/format,png" alt="img"></p>
<p>有些更加喜欢原始风格的同学可以看这个页面。另外，swagger有很多注解，可以使文档展示的信息更加完善和友好，大家可以自行尝试和学习。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/linux%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/linux%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-03-27 11:15:43" itemprop="dateModified" datetime="2020-03-27T11:15:43+08:00">2020-03-27</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-编译通过，运行时提示找不到库文件"><a href="#1-编译通过，运行时提示找不到库文件" class="headerlink" title="1 编译通过，运行时提示找不到库文件"></a>1 编译通过，运行时提示找不到库文件</h2><pre><code>libglog.so.0: cannot open shared object file: No such file or directory</code></pre>
<p>dconfig是一个动态链接库管理命令，其目的为了让动态链接库为系统所共享。<br>ldconfig的主要用途：<br>默认搜寻/lilb和/usr/lib，以及配置文件/etc/ld.so.conf内所列的目录下的库文件。<br>搜索出可共享的动态链接库，库文件的格式为：lib***.so.**，进而创建出动态装入程序(ld.so)所需的连接和缓存文件。<br>缓存文件默认为/etc/ld.so.cache，该文件保存已排好序的动态链接库名字列表。<br>ldconfig通常在系统启动时运行，而当用户安装了一个新的动态链接库时，就需要手工运行这个命令。</p>
<h1 id="一-安装配置mysql数据库"><a href="#一-安装配置mysql数据库" class="headerlink" title="一 安装配置mysql数据库"></a>一 安装配置mysql数据库</h1><h2 id="1-安装MySQL"><a href="#1-安装MySQL" class="headerlink" title="1.安装MySQL"></a>1.安装MySQL</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install mysql-server</span><br></pre></td></tr></table></figure>


<h2 id="2-配置MySQL"><a href="#2-配置MySQL" class="headerlink" title="2.配置MySQL"></a>2.配置MySQL</h2><p>查看运行状态</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl status mysql.service</span><br></pre></td></tr></table></figure>
<p>配置root用户的用户名和密码，设置本体访问权限</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">update mysql.user </span><br><span class="line">set authentication_string&#x3D;password(&#39;root&#39;) </span><br><span class="line">set plugin&#x3D;&quot;mysql_native_password&quot;</span><br><span class="line">where host  &#x3D;&#39;localhost&#39; and user&#x3D;&#39;root&#39;;</span><br></pre></td></tr></table></figure>
<h2 id="MySql远程访问"><a href="#MySql远程访问" class="headerlink" title="MySql远程访问"></a>MySql远程访问</h2><h3 id="1-改表法。"><a href="#1-改表法。" class="headerlink" title="1  改表法。"></a>1  改表法。</h3><p>可能是你的帐号不允许从远程登陆，只能在localhost。这个时候只要在localhost的那台电脑，登入mysql后，更改 “mysql” 数据库里的 “user” 表里的 “host” 项，从”localhost”改称”%”</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mysql -u root -pvmwaremysql&gt;use mysql;</span><br><span class="line"></span><br><span class="line">mysql&gt; update user set host &#x3D; &#39;%&#39; where user &#x3D; &#39;root&#39;;</span><br><span class="line"></span><br><span class="line">mysql&gt; select host, user from user;</span><br></pre></td></tr></table></figure>
<h3 id="2-授权法。"><a href="#2-授权法。" class="headerlink" title="2 授权法。"></a>2 授权法。</h3><p>例如，你想myuser使用mypassword从任何主机连接到mysql服务器的话。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#39;myuser&#39;@&#39;%&#39; IDENTIFIED BY &#39;mypassword&#39; WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">FLUSH   PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>如果你想允许用户myuser从ip为192.168.1.6的主机连接到mysql服务器，并使用mypassword作为密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON *.* TO &#39;myuser&#39;@&#39;192.168.1.3&#39; IDENTIFIED BY &#39;mypassword&#39; WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">FLUSH   PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>如果你想允许用户myuser从ip为192.168.1.6的主机连接到mysql服务器的dk数据库，并使用mypassword作为密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GRANT ALL PRIVILEGES ON dk.* TO &#39;myuser&#39;@&#39;192.168.1.3&#39; IDENTIFIED BY &#39;mypassword&#39; WITH GRANT OPTION;</span><br><span class="line"></span><br><span class="line">FLUSH   PRIVILEGES;</span><br></pre></td></tr></table></figure>
<p>我用的第一个方法,刚开始发现不行,在网上查了一下,少执行一个语句 mysql&gt;FLUSH RIVILEGES 使修改生效.就可以了</p>
<p>另外一种方法,不过我没有亲自试过的,在csdn.net上找的,可以看一下.</p>
<p>在安装mysql的机器上运行：</p>
<p>1、d:\mysql\bin&gt;mysql   -h   localhost   -u   root //这样应该可以进入MySQL服务器</p>
<p>2、mysql&gt;GRANT   ALL   PRIVILEGES   ON   <em>.</em>   TO   ‘root’@’%’   WITH   GRANT   OPTION //赋予任何主机访问数据的权限</p>
<p>3、mysql&gt;FLUSH   PRIVILEGES //修改生效</p>
<p>4、mysql&gt;EXIT //退出MySQL服务器</p>
<p>这样就可以在其它任何的主机上以root身份登录啦！</p>
<h1 id="二-安装ftp"><a href="#二-安装ftp" class="headerlink" title="二 安装ftp"></a>二 安装ftp</h1><h2 id="1、首先用命令检查是否安装了vsftpd"><a href="#1、首先用命令检查是否安装了vsftpd" class="headerlink" title="1、首先用命令检查是否安装了vsftpd"></a>1、首先用命令检查是否安装了vsftpd</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vsftpd -version</span><br></pre></td></tr></table></figure>

<p><img src="https://www.linuxidc.com/upload/2016_12/161220083241911.png" alt="这里写图片描述"><br>如果未安装用一下命令安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install vsftpd</span><br></pre></td></tr></table></figure>

<p>安装完成后，再次输入vsftpd -version命令查看是否安装成功</p>
<h2 id="2、新建一个文件夹用于FTP的工作目录"><a href="#2、新建一个文件夹用于FTP的工作目录" class="headerlink" title="2、新建一个文件夹用于FTP的工作目录"></a>2、新建一个文件夹用于FTP的工作目录</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir &#x2F;home&#x2F;ftp</span><br></pre></td></tr></table></figure>

<p><img src="https://www.linuxidc.com/upload/2016_12/161220083241912.png" alt="这里写图片描述"></p>
<h2 id="3、新建FTP用户并设置密码以及工作目录"><a href="#3、新建FTP用户并设置密码以及工作目录" class="headerlink" title="3、新建FTP用户并设置密码以及工作目录"></a>3、新建FTP用户并设置密码以及工作目录</h2><p><strong>ftpname为你为该ftp创建的用户名</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd -d &#x2F;home&#x2F;ftp -s &#x2F;bin&#x2F;bash ftpname</span><br></pre></td></tr></table></figure>

<p><img src="https://www.linuxidc.com/upload/2016_12/161220083241913.png" alt="这里写图片描述"></p>
<p>为新建的用户设置密码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">passwd ftpname</span><br></pre></td></tr></table></figure>

<p>【注释：用cat etc/passwd可以查看当前系统用户】</p>
<h2 id="4、修改vsftpd配置文件"><a href="#4、修改vsftpd配置文件" class="headerlink" title="4、修改vsftpd配置文件"></a>4、修改vsftpd配置文件</h2><p>用命令打开vsftpd.conf</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi vsftpd.conf</span><br></pre></td></tr></table></figure>

<p><img src="https://www.linuxidc.com/upload/2016_12/161220083241914.png" alt="这里写图片描述"><br>设置属性值<br>anonymous_enable=NO #禁止匿名访问<br>local_enable=YES<br>write_enable =YES<br>保存返回 </p>
<h2 id="5、启动vsftpd服务"><a href="#5、启动vsftpd服务" class="headerlink" title="5、启动vsftpd服务"></a>5、启动vsftpd服务</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service vsftpd start</span><br></pre></td></tr></table></figure>

<h1 id="三-安装依赖库"><a href="#三-安装依赖库" class="headerlink" title="三 安装依赖库"></a>三 安装依赖库</h1><h2 id="1-安装grpc库"><a href="#1-安装grpc库" class="headerlink" title="1 安装grpc库"></a>1 安装grpc库</h2><p>1）首先安装pkg-config：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install pkg-config</span><br></pre></td></tr></table></figure>
<p>2）然后安装依赖文件autoconf、automake、libtool、make、g++、unzip、libgflags-dev、libgtest-dev、clang、libc++-dev：       </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install autoconf automake libtool make g++ unzip</span><br><span class="line">sudo apt-get install libgflags-dev libgtest-dev</span><br><span class="line">sudo apt-get install clang libc++-dev</span><br></pre></td></tr></table></figure>
<p>3)、下载GRPC<br>  注意，github速度很慢，有时会下不下来，可以用以前下载完的源代码直接使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;grpc&#x2F;grpc.git</span><br><span class="line">cd grpc</span><br><span class="line">git submodule update --init  &#x2F;&#x2F;更新第三方源码</span><br></pre></td></tr></table></figure>
<p>4)、安装protobuf源码：    </p>
<pre><code>cd third_party/protobuf/
git submodule update --init --recursive   //确保克隆子模块，更新第三方源码
./autogen.sh       //生成配置脚本
./configure        //生成Makefile文件，为下一步的编译做准备，可以加上安装路径：--prefix=path
make               //从Makefile读取指令，然后编译
make check         //可能会报错，但是不影响
sudo make install  //从Makefile读取指令，安装到指定位置，默认为/usr/local/，也可以指定安装目录：--prefix=path。
    卸载的命令为make uninstall。make clean：清除编译产生的可执行文件及目标文件(object file，*.o)。make distclean：
    除了清除可执行文件和目标文件外，把configure所产生的Makefile也清除掉。//
sudo ldconfig       // 更新共享库缓存
which protoc       // 查看软件的安装位置
protoc --version   //检查是否安装成功</code></pre>
<p>5)、安装GRPC   </p>
<pre><code>cd ../..
make                    //从Makefile读取指令，然后编译
sudo make install       //从Makefile读取指令，安装到指定位置，默认为/usr/local/，这里可以加上安装路径：prefix=/usr/local/</code></pre>
<p>6)、测试用例</p>
<pre><code>cd examples/cpp/helloworld/
make                 //编译
./greeter_server     //服务器
./greeter_client     //客户端（重新开一个服务器连接）</code></pre>
<h2 id="2-安装zeromq"><a href="#2-安装zeromq" class="headerlink" title="2 安装zeromq"></a>2 安装zeromq</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install libzmq3-dev</span><br></pre></td></tr></table></figure>

<h2 id="3-安装boost"><a href="#3-安装boost" class="headerlink" title="3 安装boost"></a>3 安装boost</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-cache search boost</span><br></pre></td></tr></table></figure>
<p>  搜到所有的boost库</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">apt-get install libboost-all-dev</span><br></pre></td></tr></table></figure>

<h1 id="四-操作Ubuntu系统"><a href="#四-操作Ubuntu系统" class="headerlink" title="四 操作Ubuntu系统"></a>四 操作Ubuntu系统</h1><h2 id="1-远程ssh连接"><a href="#1-远程ssh连接" class="headerlink" title="1 远程ssh连接"></a>1 远程ssh连接</h2><p>在程序中搜索 desktop 或者remmina 出来一个remmina软件，这个软件支持ssh协议，这个协议可以远程ssh连接linux系统</p>
<h2 id="2-ubuntu下使用ftp连接服务器"><a href="#2-ubuntu下使用ftp连接服务器" class="headerlink" title="2 ubuntu下使用ftp连接服务器"></a>2 ubuntu下使用ftp连接服务器</h2><p>在程序中搜索 desktop 或者remmina 出来一个remmina软件，这个软件支持sftp协议，可以用于连接ftp</p>
<h2 id="3-ubuntu-下-远程windows系统"><a href="#3-ubuntu-下-远程windows系统" class="headerlink" title="3 ubuntu 下 远程windows系统"></a>3 ubuntu 下 远程windows系统</h2><p>在程序中搜索 desktop 或者remmina 出来一个remmina软件，这个软件支持RDP远程桌面连接，连接时勾选下面的共享目录即可传文件</p>
<h2 id="4-ubuntu-下使用mysql"><a href="#4-ubuntu-下使用mysql" class="headerlink" title="4 ubuntu 下使用mysql"></a>4 ubuntu 下使用mysql</h2><p>在ubuntu下使用mysql，可以在命令行中用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -uroot -p</span><br></pre></td></tr></table></figure>

<p>然后输入密码，进入mysql的工作环境，首先使用use 数据库名，更换以下数据库，然后就可以查看数据库了，</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">show tables  #显示所有表</span><br><span class="line">show databases  #显示所有数据库</span><br><span class="line">create database ccs # 创建数据库</span><br><span class="line">source *.sql   #导入数据库文件</span><br></pre></td></tr></table></figure>



<h1 id="五-安装glog"><a href="#五-安装glog" class="headerlink" title="五 安装glog"></a>五 安装glog</h1><h2 id="1-安装"><a href="#1-安装" class="headerlink" title="1 安装"></a>1 安装</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1 Git clone https:&#x2F;&#x2F;github.com&#x2F;google&#x2F;glog.git</span><br><span class="line">2 cd glog</span><br><span class="line">3 .&#x2F;autogen.sh</span><br><span class="line">4 .&#x2F;configure  --prefix&#x3D;path(install)</span><br><span class="line">5 make</span><br><span class="line">6 make install</span><br></pre></td></tr></table></figure>

<p>从安装目录得到lib 和include</p>
<h2 id="2-使用"><a href="#2-使用" class="headerlink" title="2 使用"></a>2 使用</h2><p>sample code:</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;glog/logging.h&quot;</span>   <span class="comment">// glog 头文件</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&quot;glog/raw_logging.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span>&#123;</span><br><span class="line">    <span class="comment">// FLAGS_log_dir=&quot;.&quot;;   //设置log目录  没有指定则输出到控制台</span></span><br><span class="line">    FLAGS_logtostderr = <span class="number">1</span>;  <span class="comment">//输出到控制台</span></span><br><span class="line">    google::InitGoogleLogging(argv[<span class="number">0</span>]);    <span class="comment">// 初始化</span></span><br><span class="line"><span class="built_in">std</span>::<span class="built_in">string</span> test = <span class="string">&quot;this is test&quot;</span>;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">2</span>, number = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">LOG(INFO) &lt;&lt; <span class="string">&quot;it is info&quot;</span>;     <span class="comment">// 打印log：“hello glog.  类似于C++ stream。</span></span><br><span class="line">LOG_IF(INFO, number &gt; <span class="number">10</span>) &lt;&lt; <span class="string">&quot;number &gt;  10&quot;</span>; </span><br><span class="line">LOG_IF(INFO, number &lt; <span class="number">10</span>) &lt;&lt; <span class="string">&quot;number &lt;  10&quot;</span>;</span><br><span class="line"><span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">20</span> ;i++)&#123;</span><br><span class="line">    LOG_EVERY_N(INFO, <span class="number">5</span>) &lt;&lt; <span class="string">&quot;log i = &quot;</span> &lt;&lt; i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">LOG(WARNING) &lt;&lt; <span class="string">&quot;It is error info&quot;</span>; </span><br><span class="line">LOG(ERROR) &lt;&lt; <span class="string">&quot;It is error info&quot;</span>; </span><br><span class="line"></span><br><span class="line">DLOG(INFO) &lt;&lt; <span class="string">&quot;it is debug mode&quot;</span>;</span><br><span class="line">DLOG_IF(INFO, number &gt; <span class="number">10</span>) &lt;&lt; <span class="string">&quot;debug number &gt; 10&quot;</span>;  </span><br><span class="line"><span class="comment">// DLOG_EVERY_N(INFO, 10) &lt;&lt; &quot;log i = &quot; &lt;&lt; i;</span></span><br><span class="line">RAW_LOG(INFO, <span class="string">&quot;it is pthread log&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">g++ test_main.cpp .&#x2F;lib&#x2F;libglog.a -I.&#x2F;include  -std&#x3D;c++11 -DDEBUG -lpthread -o sample</span><br></pre></td></tr></table></figure>

<p>控制台直接输出结果:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">I0228 20:03:53.824311  1721 test_main.cpp:15] it is info</span><br><span class="line">I0228 20:03:53.824481  1721 test_main.cpp:17] number &lt;  10</span><br><span class="line">I0228 20:03:53.824519  1721 test_main.cpp:19] log i &#x3D; 0</span><br><span class="line">I0228 20:03:53.824538  1721 test_main.cpp:19] log i &#x3D; 5</span><br><span class="line">I0228 20:03:53.824558  1721 test_main.cpp:19] log i &#x3D; 10</span><br><span class="line">I0228 20:03:53.824579  1721 test_main.cpp:19] log i &#x3D; 15</span><br><span class="line">W0228 20:03:53.824596  1721 test_main.cpp:23] It is error info</span><br><span class="line">E0228 20:03:53.824612  1721 test_main.cpp:24] It is error info</span><br><span class="line">I0228 20:03:53.824628  1721 test_main.cpp:26] it is debug mode</span><br></pre></td></tr></table></figure>



<h2 id="3-说明："><a href="#3-说明：" class="headerlink" title="3 说明："></a>3 说明：</h2><p>3.1 log输出说明</p>
<p>I0228 20:03:53.824311  1721 test_main.cpp:15] it is info</p>
<p>输出信息对应<br>I日期 时：分：秒.微秒 线程号 源文件名：行数] 信息<br>I是log等级首字母<br>3.2 log文件名说明</p>
<p>sample： sample.sa02.jw.li.log.INFO.20180228-194622.995<br><program name>.<hostname>.<user name>.log.<severity level>.<date>.<time>.<pid></p>
<pre><code>1
2</code></pre>
<p>其实对应google::InitGoogleLogging(argv[0])；中的argv[0]，即通过改变google::InitGoogleLogging的参数可以修改日志文件的名称。<br>3.3 log等级（severity level）</p>
<p>INFO(=0)<br>3.4 条件输出</p>
<p>LOG_IF(INFO, number &lt; 10) &lt;&lt; “number &lt;  10”;</p>
<pre><code>1</code></pre>
<p>当number &gt; 10条件成立时，“ “number &lt; 10”才会输出<br>LOG_EVERY_N(INFO, 5) &lt;&lt; “log i = ” &lt;&lt; i;<br>当程序中周期性的记录日志信息，在该语句第1、6、11……次被执行的时候，才会打印该log<br>3.5 debug模式下使用的宏</p>
<p>glog提供特定的宏只在debug模式下生效。以下分别对应LOG、LOG_IF、DLOG_EVERY_N操作的专用宏。</p>
<p>   DLOG(INFO) &lt;&lt; “Found cookies”;<br>   DLOG_IF(INFO, num_cookies &gt; 10) &lt;&lt; “Got lots of cookies”;<br>   DLOG_EVERY_N(INFO, 10) &lt;&lt; “Got the “ &lt;&lt; COUNTER &lt;&lt; “th cookie”;</p>
<pre><code>1
2
3</code></pre>
<p>g++ test_main.cpp ./lib/libglog.a -I./include -DDEBUG -lpthread -o sample<br>加上-DDEBUG 编译参数<br>3.6 线程安全log宏</p>
<p>glog提供了线程安全的日志记录方式。在&lt;glog/raw_logging.h&gt;文件中提供了相关的宏，如，RAW_CHECK，RAW_LOG等。这些宏的功能与CHECK，LOG等一致，除此以外支持线程安全，不需要为其分配任何内存和提供额外的锁（lock）机制。</p>
<p>RAW_LOG(INFO, “it is pthread log”);</p>
<pre><code>1</code></pre>
<p>3.7 通过符号变量配置glog</p>
<p>FLAGS_log_dir=”.”;   //设置log目录  没有指定则输出到控制台<br>FLAGS_logtostderr = 1;  //输出到控制台</p>
<p>在程序中，通过修改全局变量(使用前缀”FLAGS_”)来设置符号变量<br>大多数符号变量修改后会立即生效<br>与输出位置有关(如FLAGS_log_dir)，如果要生效需要在google::InitGoogleLogging()之前设置</p>
<p>符号变量包括：</p>
<p>logtostderr(bool,default=false),                                 只输出到STDERR而不写入日志文件<br>stderrthreshold(int,default=2,which is ERROR)，高于该级别的日志除写入日志文件还输出到STDERR<br>minloglevel(int,default=0,which is INFO)，          低于该级别的日志消息不输出<br>log_dir(string,default=””)，                                      日志输出目录<br>v(int,default=0)，                                                       小于等于该值的VLOG(m)会被输出，否则不会输出<br>vmodule(string,default=””)，                                    可为源文件定制VLOG日志输出级别<br>max_log_size(int,default=1800)，                            日志文件最大值(单位MB)<br>log_link(string,default=””)，                                     日志文件的连接所在的文件夹<br>stop_logging_if_full_disk(bool,default=false)，     如果磁盘写满是否停止记录日志<br>alsologtoemail(string,default=””)，                          是否将日志额外发送邮件到指定地址<br>logemaillevel(int,default=999)，                               设置发送邮件的日志等级<br>logmailer(string,default=”/bin/mail”)，                  发送邮件程序</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://zhangfengqilk.github.io/2020/11/23/82%20springboot%EF%BC%9A%20%E7%BA%BF%E7%A8%8B%E6%B1%A0ThreadPoolTaskExecutor/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="PALM BEACH">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/11/23/82%20springboot%EF%BC%9A%20%E7%BA%BF%E7%A8%8B%E6%B1%A0ThreadPoolTaskExecutor/" class="post-title-link" itemprop="url">Untitled</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2020-11-23 10:01:01" itemprop="dateCreated datePublished" datetime="2020-11-23T10:01:01+08:00">2020-11-23</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">Edited on</span>
        <time title="Modified: 2020-07-06 08:35:00" itemprop="dateModified" datetime="2020-07-06T08:35:00+08:00">2020-07-06</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="82-springboot：-线程池ThreadPoolTaskExecutor"><a href="#82-springboot：-线程池ThreadPoolTaskExecutor" class="headerlink" title="82 springboot： 线程池ThreadPoolTaskExecutor"></a>82 springboot： 线程池ThreadPoolTaskExecutor</h1><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="function"><span class="keyword">public</span> Executor <span class="title">getAsyncExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">     executor.setCorePoolSize(<span class="number">2</span>);<span class="comment">//核心线程大小</span></span><br><span class="line">     executor.setMaxPoolSize(<span class="number">2</span>);<span class="comment">//最大线程大小</span></span><br><span class="line">     executor.setQueueCapacity(<span class="number">500</span>);<span class="comment">//d队列最大容量</span></span><br><span class="line">executor.setThreadNamePrefix(<span class="string">&quot;Gith&quot;</span>);</span><br><span class="line">      executor.setKeepAliveSeconds(<span class="number">3000</span>);<span class="comment">//最大存活 时间</span></span><br><span class="line">     executor.initialize();</span><br><span class="line">     executor.submit(<span class="keyword">new</span> ThreadDemo());</span><br><span class="line">     <span class="keyword">return</span> executor;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>CorePoolSize 核心线程大小<br>keepAliveSeconds 线程池所能允许的空闲时间<br>maxPoolSize 线程池维护线程的最大数量<br>queueCapacity 线程池所能使用的缓冲队列</p>
<p>当一个任务通过execute(方法，欲加到线程池中时；)<br>1 如果此时线程池中的数量小于corePoolSize，即使线程池中的线程都处于空闲状态，也要创建新的线程来处理被添加的任务。</p>
<p>2，如果线程池中的数量等于corePoolsize，缓冲队列workQueue未满，那么任务被放入缓冲队列<br>3，如果此时线程池中的数量大于coreSize,缓冲队列workQueue满，并且线程池的数量小于maximumPoolSize,建立新的线程来处理被添加的任务。</p>
<p>4 如果此时线程池中的数量大于corePoolSize,缓冲队列workQueue满，并且线程池中的数量等于maximumPoolSize，那么通过handler所指定的策略来处理任务。也就是：处理任务的优先级为: 核心线程corePoolSize, 任务队列workQueue,最大线程maximumPoolSize，如果三者都满了，使用handler处理被拒绝的任务。</p>
<p>5，当线程池中的线程数量大于corePoolSize 时，如果某线程空闲时间超过keepAliveTime，线程将被终止。这样，线程池可以动态的调整池中的线程数。</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ch2.taskexecutor;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//执行器</span></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="comment">//异步捕获助手</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.aop.interceptor.AsyncUncaughtExceptionHandler;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.<span class="keyword">annotation</span>.ComponentScan;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//配置</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.<span class="keyword">annotation</span>.AsyncConfigurer;</span><br><span class="line"><span class="comment">//异步支持注解</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.<span class="keyword">annotation</span>.EnableAsync;</span><br><span class="line"><span class="comment">//线程池</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="comment">//声明这是一个配置类</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="comment">//引入ch2.taskexecutor下面的@service,@component,@repository,@controller注册为bean</span></span><br><span class="line"><span class="meta">@ComponentScan(<span class="meta-string">&quot;ch2.taskexecutor&quot;</span>)</span></span><br><span class="line"><span class="comment">//开启注解：开启异步支持</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"> </span><br><span class="line"><span class="comment">//配置类实现AsyncConfigurer接口并重写AsyncConfigurer方法，并返回一个ThreadPoolTaskExecutor</span></span><br><span class="line"><span class="comment">//这样我们就得到了一个基于线程池的TaskExecutor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TaskExecutorConfig</span> <span class="title">implements</span> <span class="title">AsyncConfigurer</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//配置类实现AsyncConfigurer接口并重写AsyncConfigurer方法，并返回一个ThreadPoolTaskExecutor</span></span><br><span class="line">    <span class="comment">//这样我们就得到了一个基于线程池的TaskExecutor</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Executor getAsyncExecutor() &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        ThreadPoolTaskExecutor taskExecutor = new ThreadPoolTaskExecutor();</span><br><span class="line">        <span class="comment">//如果池中的实际线程数小于corePoolSize,无论是否其中有空闲的线程，都会给新的任务产生新的线程</span></span><br><span class="line">        taskExecutor.setCorePoolSize(<span class="number">5</span>);</span><br><span class="line">        <span class="comment">//连接池中保留的最大连接数。Default: 15 maxPoolSize  </span></span><br><span class="line">        taskExecutor.setMaxPoolSize(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//queueCapacity 线程池所使用的缓冲队列</span></span><br><span class="line">        taskExecutor.setQueueCapacity(<span class="number">25</span>);</span><br><span class="line">        taskExecutor.initialize();</span><br><span class="line">        <span class="keyword">return</span> taskExecutor;</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> AsyncUncaughtExceptionHandler getAsyncUncaughtExceptionHandler() &#123;</span><br><span class="line">        <span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ch2.taskexecutor;</span><br><span class="line"><span class="comment">//组件声明类</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="comment">//异步声明,如果在方法表示是异步方法，如果在类表示异步类。</span></span><br><span class="line"><span class="comment">//这里的方法自动被注入使用ThreadPoolTaskExecutor作为TaskExecutor（线程池）</span></span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"> </span><br><span class="line"><span class="comment">//声明为组件</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncService</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//异步声明,如果在方法处表示是异步方法，如果在类处表示异步类（所有的方法都是异步方法）。</span></span><br><span class="line">    <span class="comment">//这里的方法自动被注入使用ThreadPoolTaskExecutor作为TaskExecutor（线程池）</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executorAsyncTask</span><span class="params">(Integer i)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行异步：&quot;</span> + i);</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">     </span><br><span class="line">    <span class="comment">//异步声明,如果在方法处表示是异步方法，如果在类处表示异步类（所有的方法都是异步方法）。</span></span><br><span class="line">    <span class="comment">//这里的方法自动被注入使用ThreadPoolTaskExecutor作为TaskExecutor（线程池）</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">executorAsyncTaskPlus</span><span class="params">(Integer i)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;执行异步任务+1: &quot;</span> + (i+<span class="number">1</span>));</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> ch2.taskexecutor;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Main</span> </span>&#123;</span><br><span class="line"> </span><br><span class="line">     </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">         </span><br><span class="line">        AnnotationConfigApplicationContext context = <span class="keyword">new</span> AnnotationConfigApplicationContext(TaskExecutorConfig.class);</span><br><span class="line">        AsyncService asyncService = context.getBean(AsyncService.class);</span><br><span class="line">         </span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i&lt;<span class="number">10</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            asyncService.executorAsyncTask(i);</span><br><span class="line">            asyncService.executorAsyncTaskPlus(i);</span><br><span class="line">        &#125;</span><br><span class="line">         </span><br><span class="line">        context.close();</span><br><span class="line">         </span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">执行异步：0</span><br><span class="line">执行异步任务+1: 1</span><br><span class="line">执行异步任务+1: 3</span><br><span class="line">执行异步：3</span><br><span class="line">执行异步任务+1: 4</span><br><span class="line">执行异步任务+1: 5</span><br><span class="line">执行异步：2</span><br><span class="line">执行异步：4</span><br><span class="line">执行异步任务+1: 6</span><br><span class="line">执行异步：5</span><br><span class="line">执行异步：1</span><br><span class="line">执行异步任务+1: 2</span><br><span class="line">执行异步任务+1: 8</span><br><span class="line">执行异步：7</span><br><span class="line">执行异步任务+1: 9</span><br><span class="line">执行异步任务+1: 7</span><br><span class="line">执行异步任务+1: 10</span><br><span class="line">执行异步：6</span><br><span class="line">执行异步：9</span><br><span class="line">执行异步：8</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



      

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      const activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      const commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

    </div>
  </main>

  <footer class="footer">
    <div class="footer-inner">
      

      

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a>
  </div>

    </div>
  </footer>

  
  <script src="//cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  


















  








  

  

</body>
</html>
